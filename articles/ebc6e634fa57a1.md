---
title: "5å¹´é–“ Laravel ã‚’ä½¿ã£ã¦è¾¿ã‚Šç€ã„ãŸï¼ŒAI æ™‚ä»£ã«è€ƒãˆã‚‹ã€Œãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã®ãã®å…ˆ"
emoji: "ğŸ¥³"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Laravel", "PHP", "DDD", "Architecture", "AI"]
published: false
---

ã“ã®è¨˜äº‹ã¯ [Laravel Advent Calendar 2025 - Qiita](https://qiita.com/advent-calendar/2025/laravel) æœ€çµ‚æ—¥ã®è¨˜äº‹ã§ã™ï¼

ä»Šå¹´éç–ã™ããƒ¯ãƒ­ã‚¿ï¼


# ã¯ã˜ã‚ã«

5 å¹´å‰ã® Laravel ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ€çµ‚æ—¥ã«æŠ•ç¨¿ã•ã‚ŒãŸã“ã®è¨˜äº‹ã‚’çš†ã•ã‚“ã¯ã”å­˜çŸ¥ã§ã—ã‚‡ã†ã‹ï¼

https://zenn.dev/mpyw/articles/ce7d09eb6d8117

ã“ã®è¨˜äº‹ã¯ Zenn ã® Laravel ãƒˆãƒ”ãƒƒã‚¯ã§æ­´ä»£ãƒ©ãƒ³ã‚­ãƒ³ã‚° 1 ä½ã‚’ã‚­ãƒ¼ãƒ—ã—ï¼Œæ—¥æœ¬ã® Laravel ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã¯ãŠãªã˜ã¿ã®è¨˜äº‹ã¨ãªã£ã¦ã„ã¾ã™ï¼

Laravel ã®ä½¿ã„ã‚„ã™ã•ã‚’ä¿ã¡ã¤ã¤ï¼Œã§ãã‚‹ã ã‘ãƒ†ã‚¹ã‚¿ãƒ–ãƒ«ã§ï¼Œä¿å®ˆæ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚¨ãƒƒã‚»ãƒ³ã‚¹ã‚’ä¸€éƒ¨å–ã‚Šè¾¼ã‚“ã ï¼Œå¤§å¤‰å®Ÿç”¨æ€§ã®é«˜ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ææ¡ˆã™ã‚‹ä¾¡å€¤ã‚ã‚‹è¨˜äº‹ã§ã™ï¼
åƒ•ã¯ 2021 å¹´æ–°å’ã®ã¨ãã«ã“ã®è¨˜äº‹ã‚’åˆã‚ã¦èª­ã¿ï¼Œãã‚Œä»¥æ¥ä½•åº¦ã‚‚ã“ã®è¨˜äº‹ã«åŠ©ã‘ã‚‰ã‚Œã¦ãã¾ã—ãŸï¼

ã¾ãŸï¼Œã“ã®è¨˜äº‹ã®è‘—è€…ã§ã‚ã‚Šï¼Œã€Œãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã®æå”±è€…ã§ã‚ã‚‹ @mpyw æ°ã¯æ–°å’æ™‚ä»£ã‹ã‚‰åŒã˜ãƒãƒ¼ãƒ ã§åƒãä»²é–“ã§ã‚ã‚Šï¼Œåƒ•ã‚’è‚²ã¦ã¦ãã‚ŒãŸå¸«åŒ çš„å­˜åœ¨ã§ã™ï¼

ãã‚“ãªå½¼ãŒç¾åœ¨ã®åƒ•ã¨åŒã„å¹´ã®ã¨ãã«æ›¸ã„ãŸã“ã®è¨˜äº‹ã«ç¶šãå½¢ã§ï¼ŒLaravel æ­´ 5 å¹´ã®åƒ•ãŒã€Œãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã‹ã‚‰ã•ã‚‰ã«ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—ã™ã‚‹ãŸã‚ã®è¨˜äº‹ã‚’ Laravel ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æœ€çµ‚æ—¥ã«æŠ•ç¨¿ã—ã¦ã‚„ã‚ã†ã¨ã„ã†ã®ãŒï¼Œã“ã®è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ï¼

9 å‰²è‡ªå·±æº€è¶³ï¼Œ1 å‰² Laravel ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¸ã®è²¢çŒ®ã®ãŸã‚ã«ï¼Œæœ¬è¨˜äº‹ã‚’åŸ·ç­†ã—ã¾ã™ï¼

# ãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æŒ¯ã‚Šè¿”ã‚‹

## ã–ã£ãã‚Šã¾ã¨ã‚

- DDD ã‚„ â€çœŸã®â€ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ï¼Œå¤§æŠµã®å ´åˆã‚ªãƒ¼ãƒãƒ¼ã‚¹ãƒšãƒƒã‚¯
- `app/UseCases` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã ã‘åˆ‡ã£ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ã”ã¨ã«å˜ä¸€è²¬å‹™ãªã‚¯ãƒ©ã‚¹ã‚’ç½®ãã¨ä½¿ã„ã‚„ã™ã„
- ActiveRecord æŒ‡å‘ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ Repository ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç„¡ç†ã‚„ã‚Šå…¥ã‚Œã‚‹ã¨æ­»ã¬
- Eloquent Model ã¯ä¾¿åˆ©ã§ä½¿ã„ãŸã„ã‹ã‚‰ UseCase ãŒ Eloquent Model ã«ä¾å­˜ã™ã‚‹ã“ã¨ã‚’è¨±å®¹ã™ã‚‹

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆæŠœç²‹ï¼‰

```
app/
â”œâ”€â”€ Http/
â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â””â”€â”€ PostController.php         # store() ãƒ¡ã‚½ãƒƒãƒ‰
â”‚   â”œâ”€â”€ Requests/
â”‚   â”‚   â””â”€â”€ Post/
â”‚   â”‚       â””â”€â”€ StoreRequest.php        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â””â”€â”€ Resources/
â”‚       â””â”€â”€ PostResource.php            # ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ•´å½¢
â”œâ”€â”€ Models/
â”‚   â”œâ”€â”€ User.php
â”‚   â”œâ”€â”€ Community.php
â”‚   â””â”€â”€ Post.php
â””â”€â”€ UseCases/
    â””â”€â”€ Post/
        â”œâ”€â”€ StoreAction.php             # ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹æœ¬ä½“
        â””â”€â”€ Exceptions/
            â””â”€â”€ PostLimitExceededException.php
```

ãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã¨å‡¦ç†ã®å…¥å£ï¼ˆHTTP ãªã‚‰ Controllerï¼ŒCLI ãªã‚‰ Consoleï¼‰ã‚’åˆ†ã‘ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã‚„ã™ãã—ã¾ã™ï¼ãªã‚“ã§ã‚‚ã‹ã‚“ã§ã‚‚ Controller ã‚„ Model ã«è©°ã‚è¾¼ã‚“ã§è²¬å‹™ãŒè‚¥å¤§åŒ–ã—ã¦ã„ãï¼Œã¨ã„ã†å•é¡Œã«å¯¾ã—ã¦ã®è‰¯ã„è§£æ±ºç­–ã«ãªã£ã¦ã„ã¾ã™ï¼

ã¾ãŸï¼Œå³æ ¼ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«æ¯”ã¹ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒæ ¼æ®µã«å°‘ãªãï¼Œå­¦ç¿’ã‚³ã‚¹ãƒˆã‚‚ä½ã„ã®ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å°å…¥ã—ã‚„ã™ã„ã¨ã„ã†ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ï¼

## æ‰€æ„Ÿ

åƒ•è‡ªèº«ï¼Œæ–°äººæ™‚ä»£ã« Fat ãª MVC ã‹ã‚‰ãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ä½¿ã£ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã—ãŸçµŒé¨“ã‚‚ã‚ã‚Šã¾ã™ã—ï¼Œåˆå­¦è€…ã«ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã„ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã ã¨æ€ã„ã¾ã™ï¼
Laravel ã®æ©Ÿèƒ½ã‚’æ®ºã•ãšã«ã†ã¾ããƒ­ã‚¸ãƒƒã‚¯ã®æ•´ç†ãŒã§ãã‚‹ãŸã‚ï¼Œå¤šãã® Web é–‹ç™ºç¾å ´ã§ã¯ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæ´»èºã™ã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼ãã“ãã“ã®è¦æ¨¡ã¾ã§ã¯è€ãˆã†ã‚‹è¨­è¨ˆã§ã™ï¼

## 2025 å¹´ï¼ŒAI æ™‚ä»£ã«çªå…¥ã—ãŸä»Šæ€ã†ã“ã¨

å…ƒè¨˜äº‹ã«ã‚‚æ›¸ã‹ã‚Œã¦ã„ã¾ã™ãŒï¼Œå³æ ¼ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ã‚ªãƒ¼ãƒãƒ¼ã‚¹ãƒšãƒƒã‚¯æ°—å‘³ã«ãªã‚ŠãŒã¡ãªã®ã¯åƒ•ã‚‚ç†è§£ã—ã¦ã„ã¾ã™ï¼ã¾ãŸï¼Œçªç„¶ãã£ã¨å­¦ç¿’ã‚³ã‚¹ãƒˆãŒä¸ŠãŒã‚‹æ„Ÿè¦šã‚‚ã‚ã‚Šã¾ã™ï¼

ã§ã‚‚ï¼Œ5 å¹´å‰ã«ãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’çŸ¥ã£ã¦å®Ÿè·µã—ã¦ããŸçš†ã•ã‚“ï¼Œãã‚ãã‚ã‚‚ã†å°‘ã—ã‚¬ãƒƒãƒ„ãƒªã‚„ã‚ŠãŸããªã„ã§ã™ã‹ï¼Ÿæ‰±ã†é–¢å¿ƒäº‹ãŒå¢—ãˆã¦ãã¦ï¼Œãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã‚‚ã¡ã‚‡ã£ã¨è¾›ããªã£ã¦ãã¦ã¾ã›ã‚“ã‹ï¼Ÿ

å½“æ™‚ã¯å­¦ç¿’ã‚³ã‚¹ãƒˆã‚‚é«˜ã‹ã£ãŸã—ï¼Œæ›¸ã‹ãªãã‚ƒã„ã‘ãªã„ã‚¯ãƒ©ã‚¹ãŒå¤šãã¦å¤§å¤‰ã§ã—ãŸï¼ã§ã‚‚ä»Šã¯ AI ãŒã„ã¾ã™ï¼å­¦ç¿’ã‚³ã‚¹ãƒˆã‚‚å®Ÿè£…ã‚³ã‚¹ãƒˆã‚‚ï¼Œ5 å¹´å‰ã¨ã¯é•ã†ã‚“ã§ã™ï¼

ã¾ãŸï¼Œè²¬å‹™åˆ†å‰²ã‚„ã•ã‚‰ãªã‚‹ç´°ã‹ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ•´ç†ã¯ï¼ŒAI ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ã›ã‚‹ã¨ãã«ã‚‚å¤§å¤‰é‡è¦ã«ãªã£ã¦ãã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ï¼
AI ã¯ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å…¨ä½“ã‚’ã”ãã£ã¨å¤‰ãˆã¦ã—ã¾ã†åŠ›ãŒã‚ã‚Šã¾ã™ãŒï¼Œä¿®æ­£ã‚¹ã‚³ãƒ¼ãƒ—ã‚’çµã‚‰ã›ã‚‹ãŸã‚ã«ã¯ï¼Œã—ã£ã‹ã‚Šé–¢å¿ƒã”ã¨ã‚’åˆ†é›¢ã—ã¦ãŠãã“ã¨ãŒå¤§åˆ‡ã§ã™ï¼

ãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ï¼ŒEloquent Model ã®å…±æœ‰ï¼ŒUseCase ã¨ DB ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å¯†çµåˆãªã©ï¼Œå–æ¨é¸æŠã®ãªã‹ã§å¦¥å”ã•ã‚Œã¦ããŸéƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ï¼
ã“ã®å¦¥å”ã•ã‚Œã¦ããŸéƒ¨åˆ†ã®æ”¹å–„ã“ãï¼ŒAI ãŒã‚³ãƒ¼ãƒ‰ã«æ‰‹ã‚’å…¥ã‚Œã‚‹éš›é©åˆ‡ã«ã‚¹ã‚³ãƒ¼ãƒ—ã‚’çµã‚‹éµã¨ãªã‚Šã¾ã™ï¼

## ã€Œãªã‚“ã¡ã‚ƒã£ã¦ã€ã®é™ç•Œ

å…ƒè¨˜äº‹ã® Q&A ã«ã‚‚ã“ã®ã‚ˆã†ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã™ï¼

> **Q7. ãƒ†ãƒ¼ãƒ–ãƒ«æ­£è¦åŒ–ã•ã‚Œã¾ãã£ã¦ã¦ï¼Œè¶…è¤‡é›‘ã‹ã¤å¤šæ©Ÿèƒ½ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã‚“ã ã‘ã©ï¼Ÿã“ã®æ¡ˆä»¶ã§ã“ã®è€ƒãˆæ–¹ä½¿ã£ã¦ã‚‚æœ¬å½“ã«å¤§ä¸ˆå¤«ï¼Ÿ**
>
> **ç„¡ç†ã§ã™ã€‚æ½”ã Eloquent Model ã‚’ä»Šã™ãå®Œå…¨ã«æ¨ã¦ã¦ï¼Œæœ¬æ°—ã§ DDD ã‚„ã‚‹æ§‹ãˆã‚’è¦‹ã›ãªã•ã„ã€‚ã„ãã‚‰ãªã‚“ã§ã‚‚é©æé©æ‰€ã£ã¦ã‚‚ã®ãŒã‚ã‚‹ã‚ˆï¼**

ã¤ã¾ã‚Šï¼Œã‚ã‚‹è¦æ¨¡ï¼Œè¤‡é›‘ã•ã‚’è¶…ãˆã‚‹ã¨ã€Œãªã‚“ã¡ã‚ƒã£ã¦ã€ã§ã¯å¯¾å¿œã—ãã‚Œãªã„ã¨ã„ã†ã“ã¨ã§ã™ï¼

å…·ä½“çš„ã«é™ç•ŒãŒæ¥ãã†ãªã‚±ãƒ¼ã‚¹ã¨ã—ã¦ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªç‚¹ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ï¼

- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³é–“ï¼‰ã®ä¾å­˜é–¢ä¿‚ãŒè¤‡é›‘åŒ–ã—ã¦ããŸ
- ã€Œã“ã® UseCaseã€ã©ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«å±ã™ã‚‹ã‚“ã ã£ã‘ï¼Ÿã€å•é¡Œ
- ãƒ†ã‚¹ãƒˆãŒæ›¸ãã¥ã‚‰ããªã£ã¦ããŸï¼ˆEloquent ã«ä¾å­˜ã—ã™ãï¼‰
- è¤‡æ•°ãƒãƒ¼ãƒ ã§é–‹ç™ºã™ã‚‹ã‚ˆã†ã«ãªã£ãŸï¼ˆå¢ƒç•ŒãŒæ›–æ˜§ã ã¨è¡çªã™ã‚‹ï¼‰

æœ¬è¨˜äº‹ã§ã¯ï¼Œã“ã‚Œã‚‰ã®å•é¡Œã«å¯¾å¿œã§ãã‚‹ã€Œãªã‚“ã¡ã‚ƒã£ã¦ã‹ã‚‰ã‚¹ãƒ†ãƒƒãƒ—ã‚¢ãƒƒãƒ—ã™ã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€ã‚’ç´¹ä»‹ã—ã¾ã™ï¼

# ãƒ‰ãƒ¡ã‚¤ãƒ³é–“ã®æ•´ç†: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã¨ Contract

ã‚ã‚‹ç¨‹åº¦å¤§ããªé–¢å¿ƒäº‹ãŒè¤‡æ•°å‡ºã¦ããŸå ´åˆï¼Œã€Œãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒ¢ãƒãƒªã‚¹ã€ã®ã‚ˆã†ã«ï¼Œæ©Ÿèƒ½ã‚„æ¥­å‹™ãƒ‰ãƒ¡ã‚¤ãƒ³ã”ã¨ã«ã€Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã¨ã—ã¦åˆ†å‰²ã™ã‚‹ã¨ã‚¹ãƒƒã‚­ãƒªã—ã¾ã™ï¼

æœ¬è¨˜äº‹ã§ã¯ï¼Œä¾‹ã¨ã—ã¦ã€Œç¤¾å†…ã®ç¨¼åƒç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€ã¨ã„ã†ä»®æƒ³ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¡Œæã«ï¼Œè¨­è¨ˆã‚’æ•´ç†ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ï¼

## æƒ³å®šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã‚’è€ƒãˆã¾ã™

```mermaid
erDiagram
    Department ||--o{ Member : "æ‰€å±"
    Member ||--o{ Capacity : "æœˆã”ã¨ã®ç¨¼åƒå¯èƒ½é‡"
    Member ||--o{ Assignment : "ã‚¢ã‚µã‚¤ãƒ³"
    Project ||--o{ Assignment : "ã‚¢ã‚µã‚¤ãƒ³"
    Project ||--o{ Requirement : "å¿…è¦äººæ•°"
```

è»½ãè¨€è‘‰ã§èª¬æ˜ã™ã‚‹ã¨ï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼

- Member ã¯ï¼ŒDepartmentï¼ˆéƒ¨ç½²ï¼‰ã«æ‰€å±
- Member ã¯ï¼Œæ¯æœˆã©ã‚Œãã‚‰ã„ç¨¼åƒã™ã‚‹ã®ã‹ï¼ˆCapacityï¼‰ã‚’ç™»éŒ²ã™ã‚‹ï¼ˆã‚¢ãƒ«ãƒã‚¤ãƒˆã‚„æ™‚çŸ­å‹¤å‹™ã«å¯¾å¿œï¼‰
- Member ã¯ï¼ŒProject ã«ã‚¢ã‚µã‚¤ãƒ³ã•ã‚Œã‚‹ï¼ˆAssignmentï¼‰
- Project ã«ã¯ï¼Œã©ã†ã„ã†äººãŒã©ã‚Œãã‚‰ã„æ¬²ã—ã„ã‹ã‚’è¨­å®šã§ãã‚‹ï¼ˆRequirementï¼‰

ã¾ãŸï¼Œå„ç¨®ãƒ‡ãƒ¼ã‚¿ã® CRUD ä»¥å¤–ã«ï¼Œæ¬¡ã®ã‚ˆã†ãªè¦ä»¶ãŒã‚ã‚Šã¾ã™

- Project ã«ã¯ï¼Œæ¡ˆä»¶æ¥­å‹™ã¨ç¤¾å†…æ´»å‹•ã®ï¼’ç¨®é¡ãŒã‚ã‚‹
- Member ã”ã¨ï¼ŒDepartment ã”ã¨ã«ç¨¼åƒç‡ã‚’è¨ˆç®—ã—ãŸã„
- Member ã”ã¨ï¼ŒDepartment ã”ã¨ã«æ¡ˆä»¶æ¥­å‹™ã¨ç¤¾å†…æ´»å‹•ã®å‰²åˆã‚’è¨ˆç®—ã—ãŸã„
- Member ã«é–¢ã—ã¦ï¼Œå˜ç´”ãªå±æ€§ã§ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«åŠ ãˆã¦è¤‡é›‘ãªæ¡ä»¶ã§æ¤œç´¢ã—ãŸã„
  - ç¤¾å†…æ´»å‹•ãŒå¤šã„ãƒ¡ãƒ³ãƒãƒ¼
  - ç›´è¿‘ï¼“ãƒ¶æœˆã§ç©ºããŒã‚ã‚‹ãƒ¡ãƒ³ãƒãƒ¼
- Project ã«é–¢ã—ã¦ï¼Œå˜ç´”ãªå±æ€§ã§ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã«åŠ ãˆã¦è¤‡é›‘ãªæ¡ä»¶ã§æ¤œç´¢ã—ãŸã„
  - ã‚¢ã‚µã‚¤ãƒ³ãŒè¶³ã‚Šã¦ãªã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã¯

æœ¬è¨˜äº‹ãŠã‚ˆã³ä»Šå›ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹ã€Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã€ã¨ã¯ï¼Œé–¢é€£ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ã¾ã¨ã‚ãŸã€Œå¢ƒç•Œã€ã§ã™ï¼

ãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ `app/UseCases/Post/` ã®ã‚ˆã†ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†ã‘ã¦ã„ã¾ã—ãŸãŒï¼Œã“ã‚Œã¯ã‚ãã¾ã§ã€Œåå‰ã€ã§åˆ†ã‘ã¦ã„ã‚‹ã ã‘ã§å®Ÿéš›ã«ã¯å¢ƒç•Œã¨å‘¼ã¹ã‚‹å³æ ¼ã•ã¯ã‚ã‚Šã¾ã›ã‚“ï¼

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã§ã¯ï¼Œå„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç‹¬ç«‹ã—ã¦é–‹ç™ºãƒ»å¤‰æ›´ã§ãã‚‹å˜ä½ã¨ãªã‚Šï¼Œä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã¯æ˜ç¢ºãªã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆå¾Œè¿°ã™ã‚‹ Contractï¼‰ã‚’é€šã˜ã¦ã®ã¿ã‚„ã‚Šã¨ã‚Šã—ã¾ã™ï¼

ã“ã®ã€Œå¢ƒç•Œã‚’æ˜ç¤ºã™ã‚‹ã€ã“ã¨ã§ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¡ãƒªãƒƒãƒˆãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š

- **å¤‰æ›´ã®å½±éŸ¿ç¯„å›²ãŒæ˜ç¢ºã«ãªã‚‹**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å†…éƒ¨å®Ÿè£…ã‚’å¤‰ãˆã¦ã‚‚ï¼ŒContract ã‚’å¤‰ãˆãªã‘ã‚Œã°ä»–ã«å½±éŸ¿ã—ãªã„
- **é™çš„è§£æã§ä¾å­˜é–¢ä¿‚ã®æ¤œè¨¼ãŒã—ã‚„ã™ããªã‚‹**: deptrac ãªã©ã®ãƒ„ãƒ¼ãƒ«ã§ä¾å­˜é–¢ä¿‚ã®é•åã‚’æ¤œå‡ºã™ã‚‹ä»•çµ„ã¿ã‚’ CI ã«æ§‹ç¯‰ã§ãã‚‹
- **åŒæ™‚ä¸¦è¡Œã—ãŸå®Ÿè£…ãŒã‚„ã‚Šã‚„ã™ããªã‚‹**: æœ€åˆã« Contract ã•ãˆæ±ºã‚ã¦ã—ã¾ãˆã°ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å®Ÿè£…ã‚’ä¸¦è¡Œã—ã¦é€²ã‚ã‚‰ã‚Œã‚‹ï¼ã“ã‚Œã«ã‚ˆã‚Š AI Agent ã‚’è¤‡æ•°ãƒ—ãƒ­ã‚»ã‚¹ç«‹ã¡ä¸Šã’ã¦ä¸€æ°—ã«å®Ÿè£…ã•ã›ã‚‹ã¨ãã«äº‹æ•…ãŒèµ·ãã¥ã‚‰ããªã‚‹ï¼ï¼ˆï¼‘ãƒ—ãƒ­ã‚»ã‚¹ã¯ Member ã® CRUDï¼Œï¼‘ãƒ—ãƒ­ã‚»ã‚¹ã¯ Project CRUD ã‚’å®Ÿè£…ã•ã›ã‚‹ï¼Œã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç¨®é¡

#### åŸºæœ¬ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆCRUD ã‚’æŒã¤ï¼‰

Memberï¼ŒProjectï¼ŒAssignment ã®ã‚ˆã†ã«ï¼Œ**ç‹¬ç«‹ã—ãŸãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«** ã‚’æŒã¤ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç®¡ç†ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼

- è‡ªèº«ã® Entity ã‚’ä½œæˆï¼Œæ›´æ–°ï¼Œå‰Šé™¤ã§ãã‚‹
- å¾Œè¿°ã™ã‚‹ Contract ã«å…¬é–‹ APIï¼ˆIDï¼ŒInterfaceï¼ŒServiceï¼‰ã‚’æŒã¤
- ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ã¯ Contract çµŒç”±ã§ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹

#### è¤‡åˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰

ãƒ‰ãƒ¡ã‚¤ãƒ³åŒå£«ãŒçµ¡ã¿åˆã£ãŸè¤‡é›‘ãªæ¤œç´¢ã‚„é›†è¨ˆã®ã‚ˆã†ã«ï¼Œ**è¤‡æ•°ã®åŸºæœ¬ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’æ¨ªæ–­**ã—ã¦æƒ…å ±ã‚’é›†ç´„ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼

- èª­ã¿å–ã‚Šå°‚ç”¨ï¼ˆä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® Entity ã‚’ä½œæˆãƒ»æ›´æ–°ã—ãªã„ï¼‰
- è¤‡æ•°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® Contract ã«ä¾å­˜ã™ã‚‹
- **è‡ªèº«ã® Contract ã‚’æŒãŸãªã„** ï¼ˆä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰å‚ç…§ã•ã‚Œãªã„ï¼‰

### æ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ‡ã‚‹åˆ¤æ–­åŸºæº–

ã™ã¹ã¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã”ã¨ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ†å‰²ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ï¼
ä»¥ä¸‹ã®ã‚ˆã†ãªåˆ¤æ–­åŸºæº–ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ‡ã‚‹ã‹ã©ã†ã‹ã‚’æ¤œè¨ã—ã¾ã™ï¼

#### ç‹¬ç«‹ã—ãŸãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’æŒã¤ã‹ï¼Ÿ

- Member ã®ä½œæˆãƒ»å‰Šé™¤ã¨ Project ã®ä½œæˆãƒ»å‰Šé™¤ã¯ç‹¬ç«‹ã—ã¦ã„ã‚‹ -> åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- Capacity ã¯ Member ã¨å¼·ãçµã³ã¤ã„ã¦ã„ã‚‹ -> Member ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã«å«ã‚ã‚‹

#### é–¢å¿ƒäº‹ãŒç‹¬ç«‹ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

- Member ã¨ Project ã¯åˆ¥ã®é–¢å¿ƒäº‹ -> åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- Member ã¨ Department ã¯è¿‘ã„ãŒï¼ŒDepartment ã¯çµ„ç¹”æ§‹é€ ã¨ã„ã†åˆ¥ã®é–¢å¿ƒäº‹ -> åˆ†ã‘ã¦ã‚‚ã„ã„ã‹ã‚‚
- Capacity ã¨ Member ã«å¼·ãä¾å­˜ -> Member ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã«ã‚ã£ã¦ã„ã„ã‹ã‚‚

#### ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¶Šå¢ƒã—ãŸ JOIN ãŒå¿…è¦ã‹ï¼Ÿ

- è¤‡æ•°ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ã¾ãŸãæ¤œç´¢ã¯ï¼Œå„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® QueryService ã‚’é †ç•ªã«å‘¼ã¶ã¨éåŠ¹ç‡ -> èª­ã¿å–ã‚Šå°‚ç”¨ã®è¤‡åˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ï¼Œè¶Šå¢ƒ JOIN ã‚’è¨±å®¹ã™ã‚‹
  - ä¾‹: MemberSearch ã¯ï¼Œç¨¼åƒãŒç©ºã„ã¦ã‚‹ Member ãªã©ã‚’æ¤œç´¢ã—ãŸã„ã®ã§ Memberï¼ŒAssignment ã‚’ JOIN ã§ãã‚‹ã¨åŠ©ã‹ã‚‹

:::message alert
ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¢ƒç•Œã‚’è¶ŠãˆãŸ JOIN ã¯ã€ä¾å­˜é–¢ä¿‚ãŒè¤‡é›‘ã«ãªã‚Šå¤‰æ›´ã®å½±éŸ¿ç¯„å›²ãŒåºƒãŒã‚Šã¾ã™ï¼
ã“ã“ã§ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å„ªå…ˆã—ãŸå¦¥å”ã¨ã—ã¦ã€èª­ã¿å–ã‚Šå°‚ç”¨ã«é™å®šã—ã¦è¨±å®¹ã—ã¦ã„ã¾ã™ï¼

ãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã‚‚ï¼Œå–æ¨é¸æŠã®ä¸­ã§å³æ ¼ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ç¦å¿Œã¨ã•ã‚Œã‚‹å½¢ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã—ãŸï¼
ã“ã†ã„ã†å½¢ã®å´©ã—ï¼Œã¨ãã«ã¯å¤§äº‹ï¼
:::

## Contract ã¨ã„ã†è€ƒãˆæ–¹

Contract ã¯ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ã€Œå…¬é–‹ APIã€ã§ã™ï¼

ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå‚ç…§ã—ã¦ã‚ˆã„ã®ã¯ Contract ã«å®šç¾©ã•ã‚ŒãŸã‚‚ã®ã ã‘ï¼
é€†ã«è¨€ãˆã°ï¼ŒContract ã«å®šç¾©ã•ã‚Œã¦ã„ãªã„ã‚‚ã®ï¼ˆDomain å±¤ã® Entity å®Ÿè£…ï¼ŒInfrastructure å±¤ã® Repository å®Ÿè£…ãªã©ï¼‰ã¯å†…éƒ¨å®Ÿè£…ã¨ã—ã¦éš è”½ã•ã‚Œã¾ã™ï¼

### Laravel Framework å®Ÿè£…ã«å­¦ã¶

å®Ÿã¯ï¼ŒLaravel è‡ªèº«ã‚‚ã“ã®æ§‹é€ ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™

```
vendor/laravel/framework/src/Illuminate/
â”œâ”€â”€ Contracts/           # Interfaceï¼ˆå…¬é–‹ APIï¼‰
â”‚   â”œâ”€â”€ Cache/
â”‚   â”‚   â””â”€â”€ Repository.php
â”‚   â”œâ”€â”€ Queue/
â”‚   â”‚   â””â”€â”€ Queue.php
â”‚   â””â”€â”€ ...
â”œâ”€â”€ Cache/               # å®Ÿè£…
â”‚   â””â”€â”€ Repository.php
â”œâ”€â”€ Queue/               # å®Ÿè£…
â”‚   â””â”€â”€ Queue.php
â””â”€â”€ ...
```

- `Illuminate\Contracts\Cache\Repository` â†’ Interfaceï¼ˆå¥‘ç´„ï¼‰
- `Illuminate\Cache\Repository` â†’ å®Ÿè£…

æœ€ã‚‚ï¼ŒLaravel ã¯ Facade ã¨ã„ã†ä»•çµ„ã¿ã§åˆ¥é€”é–‹ç™ºè€…ã«ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã¦ã„ã‚‹ã®ã§ï¼Œ`Illuminate\Contracts` ã‚’ç›´æ¥æ„è­˜ã—ãŸã“ã¨ãŒãªã„æ–¹ã‚‚å¤šã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼

ã—ã‹ã—ï¼Œãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å†…éƒ¨ã§ã¯ã“ã®ã€ŒContract ã¨å®Ÿè£…ã®åˆ†é›¢ã€ãŒå¾¹åº•ã•ã‚Œã¦ãŠã‚Šï¼Œã“ã‚Œã«ã‚ˆã‚Š Cache ã®å®Ÿè£…ã‚’ Redis ã‹ã‚‰ Memcached ã«å·®ã—æ›¿ãˆã¦ã‚‚ï¼Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã®ã‚³ãƒ¼ãƒ‰ã«å½±éŸ¿ã—ã¾ã›ã‚“ï¼

æœ¬è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ ã‚‚ï¼Œã“ã®è€ƒãˆæ–¹ã‚’è¸è¥²ã—ã¦ã„ã¾ã™ï¼
**Contract ã«å®šç¾©ã—ãŸã‚‚ã®ã ã‘ãŒå…¬é–‹ APIï¼ãã‚Œä»¥å¤–ã¯å†…éƒ¨å®Ÿè£…ã¨ã—ã¦éš è”½ã•ã‚Œã‚‹**â”€â”€ã“ã‚ŒãŒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã®æ ¸å¿ƒã§ã™ï¼

Contract ã«é–¢ã—ã¦ã¯ Laravel ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«ã‚‚ãƒšãƒ¼ã‚¸ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ãœã²èª­ã‚“ã§ã¿ã¦ãã ã•ã„ï¼

https://laravel.com/docs/12.x/contracts

### Contract ã«é…ç½®ã•ã‚Œã‚‹ã‚‚ã®

| ç¨®é¡ | ä¾‹ | ç”¨é€” |
|-----|-----|------|
| **IDï¼ˆValueObjectï¼‰** | `MemberId`, `ProjectId` | å‹å®‰å…¨ãªè­˜åˆ¥å­ |
| **Entity Interface** | `MemberInterface` | Entity ã®èª­ã¿å–ã‚Šå°‚ç”¨å¥‘ç´„ |
| **Service Interface** | `MemberQueryService` | ä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«å…¬é–‹ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®å¥‘ç´„ |
| **Exception** | `MemberNotFoundException` | ãƒ‰ãƒ¡ã‚¤ãƒ³ä¾‹å¤– |
| **Enum** | `ProjectType` | å…±æœ‰ã•ã‚Œã‚‹åˆ—æŒ™å‹ |

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆä¾‹ï¼‰

```
modules/Contract/
â”œâ”€â”€ Kernel/                  # SharedKernelï¼ˆå¾Œè¿°ï¼å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å…±é€šï¼‰
â”‚   â”œâ”€â”€ Id/
â”‚   â”‚   â””â”€â”€ HasId.php        # ID ç”¨ trait
â”‚   â”œâ”€â”€ Exception/
â”‚   â”‚   â”œâ”€â”€ DomainException.php
â”‚   â”‚   â””â”€â”€ TechnicalException.php
â”‚   â””â”€â”€ Pagination/
â”‚       â””â”€â”€ Paginator.php
â”‚
â”œâ”€â”€ Member/                  # Member ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å¥‘ç´„
â”‚   â”œâ”€â”€ Identities/
â”‚   â”‚   â””â”€â”€ MemberId.php
â”‚   â”œâ”€â”€ Entities/
â”‚   â”‚   â””â”€â”€ MemberInterface.php
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â””â”€â”€ MemberQueryService.php
â”‚   â””â”€â”€ Exceptions/
â”‚       â””â”€â”€ MemberNotFoundException.php
â”‚
â””â”€â”€ Project/                 # Project ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å¥‘ç´„
    â”œâ”€â”€ Identities/
    â”‚   â””â”€â”€ ProjectId.php
    â”œâ”€â”€ Entities/
    â”‚   â””â”€â”€ ProjectInterface.php
    â””â”€â”€ Enums/
        â””â”€â”€ ProjectType.php
```

## ä»Šå›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²

ä»¥ä¸Šã‚’è¸ã¾ãˆã¦ï¼Œä»Šå›ã®æƒ³å®šã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã«ã—ã¾ã—ãŸï¼

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | ç¨®é¡ | å«ã¾ã‚Œã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ | å‚™è€ƒ |
|-----------|------|-----------------|------|
| Member | åŸºæœ¬ | Member, Capacity | ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ï¼ç¨¼åƒå¯èƒ½é‡ã‚‚ä¸€ç·’ã« |
| Department | åŸºæœ¬ | Department | çµ„ç¹”æ§‹é€ ï¼Member ã¨ã¯åˆ¥ã®é–¢å¿ƒäº‹ |
| Project | åŸºæœ¬ | Project, Requirement | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ï¼å¿…è¦äººæ•°ã‚‚ä¸€ç·’ã« |
| Assignment | åŸºæœ¬ | Assignment | ã‚¢ã‚µã‚¤ãƒ³ç®¡ç†ï¼Member ã¨ Project ã‚’ã¤ãªã |
| MemberSearch | è¤‡åˆ | - | è¤‡é›‘ãªæ¡ä»¶ã§ãƒ¡ãƒ³ãƒãƒ¼ã‚’æ¤œç´¢ |
| WorkloadOverview | è¤‡åˆ | - | ç¨¼åƒç‡ã®é›†è¨ˆãƒ»å¯è¦–åŒ– |

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«ï¼‰

```
modules/
â”œâ”€â”€ Contract/           # å…¬é–‹ API
â”‚   â”œâ”€â”€ Kernel/         # SharedKernelï¼ˆå…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å…±é€šï¼‰
â”‚   â”œâ”€â”€ Member/
â”‚   â”œâ”€â”€ Department/
â”‚   â”œâ”€â”€ Project/
â”‚   â””â”€â”€ Assignment/
â”‚
â”œâ”€â”€ Member/             # åŸºæœ¬ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ Department/         # åŸºæœ¬ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ Project/            # åŸºæœ¬ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ Assignment/         # åŸºæœ¬ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚
â”œâ”€â”€ MemberSearch/       # è¤‡åˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆContract ãªã—ï¼‰
â””â”€â”€ WorkloadOverview/   # è¤‡åˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆContract ãªã—ï¼‰
```

## åˆ†å‰²ã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ Contract ã®ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ¡ãƒ¼ã‚¸

å¾Œè¿°ã™ã‚‹ï¼”å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ¦‚å¿µã‚‚å«ã‚ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ä¾å­˜ã‚’ Contract çµŒç”±ã§è¡Œã†ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å›³å¼åŒ–ã—ã¦ã¿ã¾ã—ãŸï¼

```mermaid
graph TB
    subgraph Contract
        subgraph CM[Contract/Member]
            CM_ID[MemberId]
            CM_IF[MemberInterface]
            CM_QS[MemberQueryService]
        end
        subgraph CP[Contract/Project]
            CP_ID[ProjectId]
            CP_IF[ProjectInterface]
        end
    end

    subgraph MemberModule[Member Module]
        subgraph M_Domain[Domain]
            M_D[Member]
        end
        subgraph M_Infra[Infrastructure]
            M_I[MemberQueryServiceImpl]
        end
    end

    subgraph ProjectModule[Project Module]
        subgraph P_Domain[Domain]
            P_D[Project]
        end
        subgraph P_App[Application]
            P_UC[ListProjectMemberUseCase]
        end
    end

    %% Member Module ãŒ Contract/Member ã‚’å®Ÿè£…
    M_D -.->|implements| CM_IF
    M_I -.->|implements| CM_QS

    %% Project Module ãŒ Contract/Project ã‚’å®Ÿè£…
    P_D -.->|implements| CP_IF

    %% Project Module ã® UseCase ãŒ Contract/Member ã«ä¾å­˜
    P_UC -->|depends on| CM_QS
    P_UC -->|depends on| CM_ID
```

- **å®Ÿç·š**: ä¾å­˜ï¼ˆdepends onï¼‰
- **ç‚¹ç·š**: å®Ÿè£…ï¼ˆimplementsï¼‰

ãƒã‚¤ãƒ³ãƒˆã¯ï¼Œ

- `ListProjectMemberUseCase` ã¯ Project Module å†…ã«ã‚ã‚‹
  - Member ã®å–å¾—ã ãŒï¼Œé–¢å¿ƒã¨ã—ã¦ã¯ Project èµ·ç‚¹ã®ãŸã‚
- Member ã®å–å¾—ãŒã—ãŸã„ã®ã§ï¼Œ `MemberQueryService` ã«ä¾å­˜ã—ã¦ã„ã‚‹
  - ä¾‹ãˆã°ï¼Œå…¥åŠ›ã¨ã—ã¦ ProjectId ã‚’å—ã‘å–ã‚Šï¼Œã‚¢ã‚µã‚¤ãƒ³ã•ã‚Œã¦ã„ã‚‹ MemberId[] ã‹ã‚‰ Member ã®è©³ç´°ãŒã»ã—ã„ï¼Œãªã©
- **Contract çµŒç”±ã§ã®ã¿ä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹**ã—ã¦ã„ã‚‹

## deptrac ã‚’ä½¿ã£ãŸé™çš„è§£æ

deptrac ã¯ï¼ŒPHP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜é–¢ä¿‚ã‚’é™çš„è§£æã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ï¼

https://github.com/deptrac/deptrac

ã€Œã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼/ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ï¼Œã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼/ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã®ã¿ä¾å­˜ã—ã¦ã„ã„ã‚ˆã€ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã‚’ YAML ã§å®šç¾©ã—ï¼Œé•åãŒã‚ã‚Œã°æ¤œå‡ºã—ã¦ãã‚Œã‚‹ã‚¹ã‚°ãƒ¬ãƒ¢ãƒã§ã™ï¼

### ä¾å­˜é–¢ä¿‚ã‚’é™çš„è§£æã§ãã‚‹ã¨ä½•ãŒå¬‰ã—ã„ã‹

#### ãƒ¬ãƒ“ãƒ¥ãƒ¼è² è·ã®è»½æ¸›

AI Agent ã«ï¼‘æ©Ÿèƒ½ã¾ã‚‹ã£ã¨å®Ÿè£…ã•ã›ã‚‰ã‚Œã‚‹æ™‚ä»£ã«ãªã£ãŸã®ã§ï¼Œä¸€åº¦ã«å¤§é‡ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼
ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ã„ä¾å­˜é–¢ä¿‚ã‚’å®ˆã£ã¦ã„ã‚‹ã‹ï¼Œç›®è¦–ã§ç¢ºèªã™ã‚‹ã®ã¯å¤§å¤‰ã§ã™ï¼

deptrac ã‚’ CI ã«çµ„ã¿è¾¼ã‚ã°ï¼Œ**ä¾å­˜é•åã¯è‡ªå‹•ã§æ¤œå‡º**ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼
ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ç¢ºèªã™ã‚‹é …ç›®ãŒæ¸›ã‚Šï¼Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒã‚§ãƒƒã‚¯ã«é›†ä¸­ã§ãã¾ã™ï¼

#### ãƒ«ãƒ¼ãƒ«ã®æ˜æ–‡åŒ–

ã€Œã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ã‚ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‚ç…§ã—ã¡ã‚ƒã ã‚ã€ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ãŒ YAML ã§è¡¨ç¾ã•ã‚Œã‚‹ã“ã¨ã§ï¼ˆå®Ÿéš›ã¯è¨±å¯ã§ã™ãŒï¼‰ï¼Œãƒãƒ¼ãƒ å…¨å“¡ãŒåŒã˜èªè­˜ã‚’æŒã¦ã¾ã™ï¼
å£é ­ã‚„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ä¼ãˆã‚‹ã‚ˆã‚Šç¢ºå®Ÿã§ã™ã­ï¼

#### ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å®‰å¿ƒæ„Ÿ

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ ã‚’å¤‰æ›´ã™ã‚‹ã¨ãï¼Œã€Œã©ã“ã‹ã§ä¾å­˜ãŒå£Šã‚Œã¦ãªã„ã‹ã€ã‚’deptrac ãŒæ¤œå‡ºã—ã¦ãã‚Œã¾ã™ï¼

ã©ã‚Œã ã‘ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ AI å‘ã‘ãƒ«ãƒ¼ãƒ«ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ãƒ«ãƒ¼ãƒ«ãªã©ï¼‰ã§ä¾å­˜é–¢ä¿‚ã‚’æ˜ç¤ºã—ã¦ã„ã¦ã‚‚ï¼Œã—ã‚Œã£ã¨åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®**å®Ÿè£…**ã‚’ç›´æ¥å‘¼ã³å‡ºã—ãŸã‚Šï¼ŒEntity ã‚’ new ã—ãŸã‚Šã—ã¦ãã¾ã™ï¼
ã“ã‚Œã‚‚ï¼Œdeptrac ã§å³æ ¼ã«ç¸›ã£ã¦ãŠãã“ã¨ã§ï¼Œä»®ã«é•åã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã•ã‚Œã¦ã‚‚ï¼Œã€Œdeptrac è½ã¡ãŸã§ï¼ç›´ã—ã¦ã€ã§ AI ã‚’æ­£ã—ã„æ–¹å‘ã«å°ã‘ã¾ã™ï¼

### YAML ã§ã®è¨­å®šä¾‹

```
deptrac/
â”œâ”€â”€ module.yaml         # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ä¾å­˜ãƒ«ãƒ¼ãƒ«
â””â”€â”€ contract.yaml       # Contract å†…éƒ¨ã®ä¾å­˜ãƒ«ãƒ¼ãƒ«
```

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ä¾å­˜ã¨ï¼ŒContract å†…éƒ¨ã®ä¾å­˜ã¯é–¢å¿ƒäº‹ãŒç•°ãªã‚‹ãŸã‚ï¼Œè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†ã‘ã¦ãŠãã¨ç®¡ç†ã—ã‚„ã™ããªã‚Šã¾ã™ï¼

#### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®ä¾å­˜ãƒ«ãƒ¼ãƒ«ï¼ˆä¾‹ï¼‰

:::details deptrac/module.yaml
```yaml
deptrac:
  paths:
    - ./modules

  layers:
    - name: Contract
      collectors:
        - type: directory
          value: modules/Contract/.*
    - name: Member
      collectors:
        - type: directory
          value: modules/Member/.*
    - name: Project
      collectors:
        - type: directory
          value: modules/Project/.*
    - name: Assignment
      collectors:
        - type: directory
          value: modules/Assignment/.*
    - name: MemberSearch
      collectors:
        - type: directory
          value: modules/MemberSearch/.*

  ruleset:
    # Contract ã¯è‡ªèº«ã®ã¿ã«ä¾å­˜
    Contract:
      - Contract

    # åŸºæœ¬ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ Contract + è‡ªèº«ã«ä¾å­˜
    Member:
      - Contract
      - Member
    Project:
      - Contract
      - Project
    Assignment:
      - Contract
      - Assignment

    # è¤‡åˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚‚ Contract + è‡ªèº«ã«ä¾å­˜
    MemberSearch:
      - Contract
      - MemberSearch
```
:::

##### ãƒã‚¤ãƒ³ãƒˆ

- **è‡ªåˆ†è‡ªèº«ã‚‚å…¥ã‚Œã‚‹**: `Member: [Contract, Member]` ã®ã‚ˆã†ã«ã€è‡ªèº«ã¸ã®ä¾å­˜ã‚‚æ˜ç¤º
- **ä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å†…éƒ¨å®Ÿè£…ã¯å‚ç…§ã—ãªã„**: Member ãŒ Project ã®å†…éƒ¨å®Ÿè£…ã‚’ç›´æ¥è§¦ã‚‹ã®ã¯ NG


#### Contract å†…éƒ¨ã®ä¾å­˜ãƒ«ãƒ¼ãƒ«ï¼ˆä¾‹ï¼‰

:::details deptrac/contract.yaml
```yaml
deptrac:
  paths:
    - ./modules/Contract

  layers:
    - name: Kernel
      collectors:
        - type: directory
          value: modules/Contract/Kernel/.*
    - name: Member
      collectors:
        - type: directory
          value: modules/Contract/Member/.*
    - name: Project
      collectors:
        - type: directory
          value: modules/Contract/Project/.*
    - name: Assignment
      collectors:
        - type: directory
          value: modules/Contract/Assignment/.*

  ruleset:
    # Kernel ã¯è‡ªèº«ã®ã¿ï¼ˆä»–ã«ä¾å­˜ã—ãªã„ï¼‰
    Kernel:
      - Kernel

    # å„ Contract ã¯ Kernel + è‡ªèº«ã«ä¾å­˜
    Member:
      - Kernel
      - Member

    # Project ã¯ MemberIdï¼ˆmanagerId ãªã©ï¼‰ã‚’å‚ç…§ã™ã‚‹ã®ã§ Member ã«ä¾å­˜
    Project:
      - Kernel
      - Project
      - Member

    # Assignment ã¯ Member ã¨ Project ã® ID ã‚’å‚ç…§ã™ã‚‹ã®ã§ä¾å­˜ã‚’è¨±å¯
    Assignment:
      - Kernel
      - Assignment
      - Member
      - Project
```
:::

##### ãƒã‚¤ãƒ³ãƒˆ

- **Kernel ã¯ä»–ã«ä¾å­˜ã—ãªã„**: ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰ã®çŸ¥è­˜ã¯å…¥ã£ã¦ã“ãªã„ã¯ãš
- **å„ Contract ã¯ Kernel ã«ä¾å­˜**: æ±ç”¨çš„ãªå…±é€šã‚¯ãƒ©ã‚¹ã‚’ä½¿ã†
- **é–¢é€£ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¸ã®ä¾å­˜ã¯æ˜ç¤º**: Project ãŒ `MemberId`ï¼ˆmanagerId ãªã©ï¼‰ã‚’æŒã¤ãªã‚‰ Member ã¸ã®ä¾å­˜ã‚’è¨±å¯

# ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…ã®æ•´ç†: ï¼”å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

å‰é …ã§ã¯ä¸»ã«ã€Œæ©Ÿèƒ½ã€ã‚„ã€Œé–¢å¿ƒäº‹ã€ã‚’è»¸ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã—ã¾ã—ãŸï¼
ã—ã‹ã—ï¼Œãã‚Œãã‚Œã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¸­ãŒã¨ã£æ•£ã‚‰ã‹ã£ã¦ã„ã¦ã¯æ„å‘³ãŒã‚ã‚Šã¾ã›ã‚“ï¼

ä»Šå›ï¼Œå„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¸­ã‚’ã€ŒPresentationã€ã€ŒDomainã€ã€ŒApplicationã€ã€ŒInfrastructureã€ã®ï¼”å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¾ã¨ã‚ã¾ã™ï¼

## ãªãœï¼”å±¤ã‹

ä»Šå›ãªãœï¼”å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ãŸã®ã‹ï¼Œãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨æ¯”è¼ƒã—ãªãŒã‚‰è€ƒãˆã¾ã™ï¼

| | ãªã‚“ã¡ã‚ƒã£ã¦ | 4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ |
|---|-------------|------------------|
| **å±¤** | Controller + UseCase + Model | Presentation + Application + Domain + Infrastructure |
| **Eloquent ä¾å­˜** | UseCase ãŒç›´æ¥ Eloquent ã‚’ä½¿ã† | Infrastructure ã«é–‰ã˜è¾¼ã‚ã‚‹ |
| **Repository** | ãªã— | Domain ã« Interfaceã€Infrastructure ã«å®Ÿè£… |
| **DTO** | ãªã—ï¼ˆRequest/Response ã‚’ç›´æ¥ä½¿ã†ï¼‰ | Input/Output ã§å‹å®‰å…¨ã« |
| **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£** | Eloquent ã«ä¾å­˜ã™ã‚‹ã®ã§ DB ãŒå¿…è¦ | Domain ã¯ç´”ç²‹ PHPã€ãƒ¢ãƒƒã‚¯ã—ã‚„ã™ã„ |

ãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ï¼Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã§ã® Eloquent ã¸ã®ä¾å­˜ã‚’è¨±å®¹ã—ã¦ã„ã¾ã—ãŸï¼
ã“ã‚Œã¯ã‚·ãƒ³ãƒ—ãƒ«ã•ã¨ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¨ã—ã¦æ­£ã—ã„é¸æŠã ã£ãŸã¨æ€ã„ã¾ã™ï¼

ã—ã‹ã—ï¼Œè¦æ¨¡ãŒå¤§ãããªã£ã¦ãã‚‹ã¨

- **UseCase ãŒè‚¥å¤§åŒ–**: ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼Œæ°¸ç¶šåŒ–ï¼Œå¤–éƒ¨ API ã¨ã®é€šä¿¡ãªã©ãŒæ··åœ¨ã™ã‚‹
- **ãƒ†ã‚¹ãƒˆãŒæ›¸ãã¥ã‚‰ã„**: DB ã‚ã‚Šãã®ãƒ†ã‚¹ãƒˆã«ãªã‚Šéƒ½åº¦ãƒ‡ãƒ¼ã‚¿ã®ç”¨æ„ãŒå¿…è¦ã ã— Feature ãƒ†ã‚¹ãƒˆãªã®ã§å®Ÿè¡Œæ™‚é–“ã‚‚ã‹ã•ã‚€
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒ Eloquent ã®å¤‰æ›´ã«å½±éŸ¿ã‚’å—ã‘ã‚‹**: Model ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚„ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¤‰ãˆã‚‹ã¨ UseCase ã‚‚ä¿®æ­£ãƒ»ç¢ºèªãŒå¿…è¦ã«ãªã‚‹

ï¼”å±¤ã«åˆ†ã‘ã‚‹ã“ã¨ã§ï¼Œè²¬å‹™ãŒæ˜ç¢ºã«ãªã‚Šï¼Œå¤‰æ›´ã®å½±éŸ¿ç¯„å›²ãŒé™å®šçš„ã«ãªã‚‹ã—ãƒ†ã‚¹ãƒˆã‚‚æ›¸ãã‚„ã™ããªã‚‹ã¨ã„ã†ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ï¼

ãŸã ã—ï¼Œå…ƒè¨˜äº‹ã§ã‚‚æ‡¸å¿µã•ã‚Œã¦ã„ãŸï¼Œã€Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆãŒè¤‡é›‘ã«ãªã£ãŸã‚Šãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒå¢—ãˆãŸã‚Šã™ã‚‹ãŸã‚ç®¡ç†ãŒå¤§å¤‰ã«ãªã‚‹ã€ã¨ã„ã†å•é¡Œã¯ç¢ºã‹ã«æ®‹ã‚Šã¾ã™ï¼
ã§ã‚‚ç¾ä»£ãªã‚‰ãã®å¤§éƒ¨åˆ†ã‚’ AI ã‚’ä½¿ã£ã¦è§£æ±ºã§ãã¾ã™ï¼ãƒ«ãƒ¼ãƒ«ã‚’ã—ã£ã‹ã‚Šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ã—ã¦ãŠãã“ã¨ã§ï¼Œã»ã¼ã™ã¹ã¦ã®å®Ÿè£…ã‚’ AI ã«ä»»ã›ã¦ã‚‚ï¼Œå•é¡Œãªã„å“è³ªã§å®Ÿè£…ã‚’é€²ã‚ã‚‰ã‚Œã¾ã™ï¼ï¼ˆå®Ÿéš›ï¼Œæœ¬è¨˜äº‹ã§ç´¹ä»‹ã—ã¦ã„ã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ï¼Œï¼™å‰²ä»¥ä¸Šã®ã‚³ãƒ¼ãƒ‰ã‚’ AI ãŒæ›¸ã„ã¦ã„ã¾ã™ï¼‰

ã¡ãªã¿ã«ï¼Œå…ˆç¨‹ãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ãŠã‘ã‚‹å„å±¤ã®å¯¾å¿œã‚’è€ƒãˆã¾ã—ãŸãŒï¼Œä¸€èˆ¬çš„ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå¯¾å¿œã«ãªã‚‹ã¨æ€ã„ã¾ã™ï¼

| æœ¬è¨˜äº‹ã®å±¤ | ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã®å¯¾å¿œ |
|-----------|---------------------------|
| Presentation | Interface Adapters (Controllers, Presenters) |
| Application | Use Cases |
| Domain | Entities |
| Infrastructure | Frameworks & Drivers |

## å„å±¤ã®å½¹å‰²ã¨ã‚¯ãƒ©ã‚¹

ï¼”ã®å±¤ã«ã¯ï¼Œãã‚Œãã‚Œä»¥ä¸‹ã®ã‚ˆã†ãªã‚¯ãƒ©ã‚¹ãŒé…ç½®ã•ã‚Œã¾ã™

| å±¤ | é…ç½®ã™ã‚‹ã‚¯ãƒ©ã‚¹ | è²¬å‹™ |
|----|--------------|------|
| **Presentation** | Controller, FormRequest, Assembler | HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ä»˜ãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ•´å½¢ |
| **Application** | UseCase(IF), Interactor, Input, Output | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œãƒ»èª¿æ•´ |
| **Domain** | Entity, VO, Repository(IF), Policy, Factory | ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ« |
| **Infrastructure** | Repositoryå®Ÿè£…, EloquentModel, ExceptionHandler | æŠ€è¡“çš„è©³ç´° |

:::message 

ã“ã“ã§è¨€ã† Domain å±¤ã® Factory ã¯ï¼ŒLaravel ã®æ©Ÿèƒ½ã¨ã—ã¦ã® Factory ã§ã¯ãªã Entity ã®ç”Ÿæˆï¼Œå¾©å…ƒè²¬å‹™ã‚’ã‚‚ã¤ Factory ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦ã® Factory ã§ã™ï¼

:::

ã¾ãŸï¼Œä¾å­˜ã®æ–¹å‘ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ«ãƒ¼ãƒ«ã‚’å®šã‚ã¾ã™

```
Presentation â†’ Application â†’ Domain â† Infrastructure
```

- **Presentation** ã¯ Application ã®ã¿ã«ä¾å­˜
- **Application** ã¯ Domain ã®ã¿ã«ä¾å­˜
- **Infrastructure** ã¯ Domain ã® Interface ã‚’å®Ÿè£…ï¼ˆä¾å­˜æ€§é€†è»¢ï¼‰
- **Domain** ã¯ä½•ã«ã‚‚ä¾å­˜ã—ãªã„ï¼ˆç´”ç²‹ãª PHPï¼‰

### Presentation å±¤

HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šï¼ŒApplication å±¤ã«å—ã‘æ¸¡ã™å…¥å£ã§ã™ï¼

| ã‚¯ãƒ©ã‚¹ | è²¬å‹™ |
|-------|------|
| **Controller** | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®çµ‚ç«¯ï¼UseCase ã‚’å‘¼ã³å‡ºã—ï¼Œçµæœã‚’è¿”ã™ |
| **FormRequest** | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼Laravel ã®æ©Ÿèƒ½ã‚’ãã®ã¾ã¾ä½¿ã† |
| **Assembler** | FormRequest â†’ Input DTO ã¸ã®å¤‰æ› |

FormRequest ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¾Œï¼Œ `validated()` ã§é…åˆ—ã«ã—ã¦ãã®ã¾ã¾ UseCase ã«æ¸¡ã™ã“ã¨ã‚‚è€ƒãˆã¾ã—ãŸãŒï¼Œã‚„ã¯ã‚Šå‹ãŒã¤ã„ã¦ãªã„ã¨ UseCase å´ã§ assert ã™ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ï¼Œå‹å®‰å…¨ãªæ–¹ã«å€’ã—ã¾ã—ãŸï¼

Assembler ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ï¼Œè©°ã‚æ›¿ãˆè²¬å‹™ã‚’ Controller ã«æŒãŸã›ã¦ã‚‚è‰¯ã„ã¨æ€ã„ã¾ã™ï¼

ã¾ãŸï¼Œãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ•´å½¢ã« API Resource ã‚’ç”¨ã„ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã¾ã—ãŸï¼
UseCase ã‹ã‚‰ Controller ã« Eloquent Model ãŒè¿”ã£ã¦ãã‚‹ãªã‚“ã¡ã‚ƒã£ã¦ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯æœ‰åŠ¹ãªé¸æŠã§ã—ãŸãŒï¼ŒEloquent Model ãŒå¤–ã«å‡ºã¦ã“ãªã„æœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯æ¡ç”¨ã‚’è¦‹é€ã‚Šã¾ã—ãŸï¼

API Resource ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚æ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒï¼Œã“ã‚Œã¯ Eloquent Model ã¨ JSON ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å¤‰æ›ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã®ä½ç½®ã¥ã‘ãŒå‰æã«ãªã£ã¦ã„ã‚‹ãŸã‚ï¼Œä»Šå›ã¯å¾Œè¿°ã™ã‚‹ UseCase ã® Output DTO ã« toArray() ã‚’å®Ÿè£…ã™ã‚‹å½¢ã‚’å–ã‚Šã¾ã—ãŸï¼

:::message
Output DTO ã« toArray() ã‚’å®Ÿè£…ã™ã‚‹ã®ã¯ Application å±¤ãŒ HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ„è­˜ã—ã¦ã„ã‚‹æ„Ÿã˜ãŒã—ã¦æ°—ã«ãªã‚‹ï¼Œã¨ã„ã†å°è±¡ã‚’æŒã¤æ–¹ã‚‚ã„ã‚‰ã£ã—ã‚ƒã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼
æ°—ã«ãªã‚‹å ´åˆã¯ Presentation å±¤å´ã«åˆ¥é€” Response æ•´å½¢ç”¨ã®ã‚¯ãƒ©ã‚¹ã‚’ä½œã£ãŸã‚Šï¼ŒController ã«æ•´å½¢ã®è²¬å‹™ã‚’è¿½ã‚ã›ãŸã‚Šã™ã‚‹ã¨è‰¯ã„ã¨æ€ã„ã¾ã™ï¼
ä»Šå›ã¯ UseCase ãŒè¿”ã™ DTO ã¯ Presentation å±¤ã«è¿”ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆï¼ HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãªã‚Šæ¨™æº–å‡ºåŠ›ãªã‚Š CSV ãªã‚Šï¼Œä½•ã‚‰ã‹ã®å½¢ã§å¤–ã«å‡ºã¦ã„ãæƒ…å ±ï¼‰ã ã¨å‰²ã‚Šåˆ‡ã£ã¦ã„ã‚‹ã®ã§ï¼Œå€‹äººçš„ã«ã¯ JSON å¤‰æ›è²¬å‹™ã‚’ã‚‚ãŸã›ã¡ã‚ƒã£ã¦ã‚‚è‰¯ã„ã‹ãªã¨æ€ã£ã¦ã„ã¾ã™ï¼
:::

:::details ProjectController
```php
class ProjectController
{
    public function store(
        StoreProjectRequest $request,
        ProjectInputAssembler $assembler,
        StoreProjectUseCase $useCase,
    ): array {
        $input = $assembler->toStoreInput($request->validated());

        $output = $useCase($input);

        return $output->toArray();
    }
```
:::

:::details StoreProjectRequest
```php
class StoreProjectRequest extends FormRequest
{
    public function rules(): array
    {
        return [
            'name' => ['required', 'string', 'max:255'],
            'client_id' => ['nullable', 'string', 'uuid'],
            'manager_id' => ['required', 'string', 'uuid'],
            'since' => ['required', 'date'],
            'until' => ['required', 'date', 'after:since'],
            'type' => ['required', 'string', Rule::enum(ProjectType::class)],
        ];
    }
}
```
:::

:::details ProjectInputAssembler
```php
class ProjectInputAssembler
{
    public function toStoreInput(array $data): StoreProjectInput
    {
        return new StoreProjectInput(
            name: $data['name'],
            clientId: ClientId::createOrNull($data['client_id'] ?? null),
            managerId: MemberId::create($data['manager_id']),
            since: LocalDate::parse($data['since']),
            until: LocalDate::parse($data['until']),
            type: ProjectType::from($data['type']),
        );
    }
}
```
:::

:::message
`MemberId` ã‚„ `ProjectType` ãªã©ã® VO ã¯ Contract ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ï¼ŒPresentation å±¤ã‹ã‚‰ã‚‚å‚ç…§ã§ãã¾ã™ï¼
ã‚‚ã— Domain å±¤ã«å®šç¾©ã•ã‚Œã¦ã„ãŸã‚‰ï¼ŒPresentation â†’ Domain ã®ä¾å­˜é•åã«ãªã‚Šã¾ã™ï¼
:::

### Application å±¤

ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè¡Œãƒ»èª¿æ•´ã‚’æ‹…å½“ã—ã¾ã™ï¼

| ã‚¯ãƒ©ã‚¹ | è²¬å‹™ |
|-------|------|
| **UseCase (Interface)** | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å¥‘ç´„ï¼ˆãƒ†ã‚¹ãƒˆæ™‚ã«å·®ã—æ›¿ãˆå¯èƒ½ï¼‰ |
| **Interactor** | UseCase ã®å®Ÿè£…ï¼Domain ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’å®Ÿç¾ |
| **Input** | å…¥åŠ› DTOï¼Presentation ã‹ã‚‰ã®å…¥åŠ›ã‚’å‹å®‰å…¨ã«å—ã‘å–ã‚‹ |
| **Output / View** | å‡ºåŠ› DTOï¼Presentation ã«è¿”ã™ãƒ‡ãƒ¼ã‚¿ |

Interactor ã¨ã„ã†è¨€è‘‰ã¯èãé¦´æŸ“ã¿ãŒãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼
UseCase ã‚’ Interface ã¨ã—ã¦å®šç¾©ã—ï¼Œãã‚Œã‚’ Interactor ã§å®Ÿè£…ã™ã‚‹å½¢ã«ãªã‚Šã¾ã™ï¼
ã“ã‚Œã¯ï¼Œãƒ†ã‚¹ãƒˆæ™‚ã« UseCase ã‚’ãƒ¢ãƒƒã‚¯ã«å·®ã—æ›¿ãˆã‚‰ã‚Œã‚‹ãŸã‚ Controller ã®ãƒ†ã‚¹ãƒˆï¼ˆFake Request ã‚’é€šã—ãŸ Form ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚¹ãƒˆãªã©ï¼‰ã‚’ã™ã‚‹å ´åˆã«ä¾¿åˆ©ã§ã™ï¼

ã¾ãŸï¼ŒInteractor è‡ªèº«ã¯ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯åŸºæœ¬æŒã¡ã¾ã›ã‚“ï¼
ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯ã‚ãã¾ã§ Domain å±¤ã«ã‚ã‚‹ Entity ã‚„ Policy ãªã©ãŒæ‹…ã„ï¼Œãã‚Œã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’å®Ÿç¾ã™ã‚‹ã®ãŒ Application å±¤ã®å½¹å‰²ã§ã™ï¼

ç§ã¨ã—ã¦ã¯ï¼Œèªå¯ã‚‚ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€éƒ¨ã ã¨è€ƒãˆã¦ã„ã‚‹ã®ã§ï¼Œèªå¯ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆPolicyï¼‰ã‚‚ Domain å±¤ã«ç½®ãã¾ã™ï¼

Interactor ã®å½¹å‰²ï¼ˆä¾‹ï¼‰
1. Policy ã§èªå¯ãƒã‚§ãƒƒã‚¯
2. Factory ã§ Entity ç”Ÿæˆ
3. Repository ã§æ°¸ç¶šåŒ–
4. Output DTO ã«å¤‰æ›ã—ã¦ return

:::details StoreProjectUseCase
```php
interface StoreProjectUseCase
{
    public function __invoke(StoreProjectInput $input): StoreProjectOutput;
}
```
:::

:::details StoreProjectInteractor
```php
class StoreProjectInteractor implements StoreProjectUseCase
{
    public function __construct(
        private ProjectFactory $factory,
        private ProjectRepository $repository,
        private StoreProjectPolicy $policy,
        private Authorizer $authorizer,
    ) {}

    public function __invoke(StoreProjectInput $input): StoreProjectOutput
    {
        $this->authorizer->authorize($this->policy);

        $project = $this->factory->create(
            name: $input->name,
            clientId: $input->clientId,
            managerId: $input->managerId,
            since: $input->since,
            until: $input->until,
            type: $input->type,
        );

        $this->repository->save($project);

        return StoreProjectOutput::fromEntity($project);
    }
}
```
:::

:::message
#### ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã«ã¤ã„ã¦

DDD ã§ã¯ã€Œé›†ç´„ï¼ˆAggregateï¼‰ã€ã¨ã„ã†æ¦‚å¿µãŒã‚ã‚Šï¼Œæ•´åˆæ€§ã‚’ä¿ã¤ã¹ãã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¾ã¨ã¾ã‚Šã‚’æŒ‡ã—ã¾ã™ï¼
ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã¯ã“ã®é›†ç´„å˜ä½ã§è¨­ã‘ã‚‹ã®ãŒåŸå‰‡ã¨ã•ã‚Œï¼ŒRepository ã¯é›†ç´„ã«å¯¾ã—ã¦ã®ã¿æä¾›ã•ã‚Œã‚‹ãŸã‚ï¼Œçµæœçš„ã«ã€ŒRepository ã®å¢ƒç•Œ â‰’ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã€ã¨ãªã‚‹ã“ã¨ãŒå¤šã„ã§ã™ï¼

ãŸã ã—ï¼Œ**é›†ç´„ã¨ Repository ã¯åˆ¥æ¦‚å¿µ**ã§ã™ï¼é›†ç´„ã¯ã€Œæ•´åˆæ€§ã®å¢ƒç•Œã€ï¼ŒRepository ã¯ã€Œæ°¸ç¶šåŒ–ã®çª“å£ã€ã§ã‚ã‚Šï¼Œå¢ƒç•ŒãŒä¸€è‡´ã™ã‚‹ã®ã¯çµæœã§ã‚ã£ã¦å®šç¾©ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼

æœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ï¼Œã‚ˆã‚Šå®Ÿè·µçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å–ã‚Šã¾ã™ï¼
**UseCaseï¼ˆInteractorï¼‰ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’è²¼ã‚‹**ã®ã‚’åŸºæœ¬ã¨ã—ã¾ã™ï¼

ãªãœ UseCase ã‹ï¼Ÿ
UseCase ã¯ã€Œãƒ“ã‚¸ãƒã‚¹ä¸Šã®ä¸€é€£ã®æ“ä½œã€ã‚’è¡¨ã™å˜ä½ã§ã™ï¼
ã€Œã“ã®æ“ä½œãŒæˆåŠŸã™ã‚‹ã‹å¤±æ•—ã™ã‚‹ã‹ã€ã‚’ä¸€ã¤ã®ã¾ã¨ã¾ã‚Šã¨ã—ã¦æ‰±ã†ã®ã«æœ€é©ãªç²’åº¦ã§ã‚ã‚Šï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã¨ã—ã¦è‡ªç„¶ã§ã™ï¼
ã¾ãŸï¼Œè¤‡æ•°ã® Repository ã‚’è·¨ãæ“ä½œã§ã‚‚ï¼ŒUseCase ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’è²¼ã‚Œã°ä¸€è²«æ€§ã‚’ä¿ã¦ã¾ã™ï¼

ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ãƒ¢ãƒãƒªã‚¹ã®å¼·ã¿ã¯ï¼Œãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯é›£ã—ã„æ•´åˆæ€§ã®æ‹…ä¿ãŒ **DB ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§ç°¡å˜ã«å®Ÿç¾ã§ãã‚‹**ã“ã¨ã§ã™ï¼
ã›ã£ã‹ããªã®ã§ï¼ŒUseCase ã§ã©ã‚“ã©ã‚“ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’è²¼ã£ã¦ã„ãã¾ã—ã‚‡ã†ï¼

ãªãŠï¼ŒLaravel ã¯ savepoint ã‚’ä½¿ã£ãŸãƒã‚¹ãƒˆã«å¯¾å¿œã—ã¦ã„ã‚‹ã®ã§ï¼ŒRepository å†…ã§é˜²å¾¡çš„ã«ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’è²¼ã£ã¦ãŠã„ã¦ã‚‚ç«¶åˆã—ã¾ã›ã‚“ï¼

#### è¤‡æ•° Module ã‚’è·¨ã„ã ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ä¾‹: Requirement ã‚’ Assignment ã§å…¥ã‚Œæ›¿ãˆã‚‹

```php
class SwapRequirementToAssignmentInteractor implements SwapRequirementToAssignmentUseCase
{
    public function __construct(
        private TransactionExecutor $transaction,
        private AssignmentFactory $factory,
        private AssignmentRepository $repository,
        private RequirementQueryService $requirementQuery,   // Project Moduleï¼ˆå‚ç…§ï¼‰
        private RequirementCommandService $requirementCommand, // Project Moduleï¼ˆæ›´æ–°ï¼‰
    ) {}

    public function __invoke(SwapRequirementToAssignmentInput $input): void
    {
        // ã‚¹ãƒ­ãƒƒãƒˆã«å¯¾å¿œã™ã‚‹ Requirement ã‚’å–å¾—
        $requirements = $this->requirementQuery->findBySlotIds($input->slotIds);

        $this->transaction->execute(function () use ($requirements, $input) {
            // Requirement â†’ Assignment ã«å¤‰æ›ï¼ˆmember_id ã‚’å……ã¦ã‚‹ï¼‰
            $assignments = $requirements->map(
                fn (Requirement $req) => $this->factory->create(
                    year: $req->year,
                    month: $req->month,
                    projectId: $req->projectId,
                    memberId: $input->memberId,
                    workload: $req->workload,
                ),
            );

            // Assignment Module: Bulk Insert
            $this->repository->bulkStore($assignments);

            // Project Module: è©²å½“ã‚¹ãƒ­ãƒƒãƒˆã® Requirement ã‚’å‰Šé™¤
            $this->requirementCommand->deleteBySlotIds($input->slotIds);
        });
    }
}
```
:::

### Domain å±¤

ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’è¡¨ç¾ã—ã¾ã™ï¼ã“ã“ã¯æ¥µåŠ›ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ä¾å­˜ã—ãªã„ç´”ç²‹ãª PHP ã§å®Ÿè£…ã—ã¾ã™ï¼

| ã‚¯ãƒ©ã‚¹ | è²¬å‹™ |
|-------|------|
| **Entity** | ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’æŒã¤ |
| **Repository (Interface)** | æ°¸ç¶šåŒ–ã®å¥‘ç´„ï¼å®Ÿè£…ã¯ Infrastructure |
| **QueryService (Interface)** | å‚ç…§ç³»ã®å¥‘ç´„ï¼è¤‡é›‘ãªæ¤œç´¢ã‚„é›†è¨ˆã‚’æ‹…ã† |
| **Policy** | èªå¯ãƒ«ãƒ¼ãƒ«ï¼ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã¨ã—ã¦ã®æ¨©é™åˆ¤å®š |
| **Factory** | Entity ã®ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ– |

Factory ã«ã¯ï¼’ã¤ã®å½¹å‰²ãŒã‚ã‚Šã¾ã™

- `create`: Entity ã®æ–°è¦ç”Ÿæˆï¼IdGenerator ã‚’ä½¿ã£ã¦ UUID ã‚’ç™ºè¡Œã—ã¤ã¤ï¼Œæ¸¡ã£ã¦ããŸå±æ€§å€¤ã§ Entity ã‚’åŸ‹ã‚ã‚‹ï¼
- `reconstruct`: DB ã‹ã‚‰æ¸¡ã£ã¦ããŸæ—¢å­˜ã®ãƒ¢ãƒ‡ãƒ«ã‚’ Entity ã«å¾©å…ƒï¼ID ã¯æ±ºã¾ã£ã¦ã„ã‚‹ã¯ãšãªã®ã§æ–°è¦ç™ºè¡Œã¯ã—ãªã„

ã“ã‚Œã«ã‚ˆã‚Š Entity ã®ç”Ÿæˆæ–¹æ³•ãŒçµ±ä¸€ã•ã‚Œï¼ŒID ã®ç™ºè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚‚æ˜ç¢ºã«ãªã‚Šã¾ã™ï¼

#### ID ã« UUID ã‚’ä½¿ã†ã¹ãç†ç”±

ä¸€èˆ¬çš„ã«ï¼ŒID ã¨ã—ã¦æ¡ç”¨ã•ã‚Œã‚‹ã®ã¯ (Big)Integer ã‹ UUID ã§ã™ï¼æ•´æ•°å‹ã®å ´åˆã¯ AutoIncrement ã¨ã—ã¦ DB ã«æ¡ç•ªã‚’ãŠä»»ã›ã™ã‚‹ã“ã¨ãŒã»ã¨ã‚“ã©ã ã¨æ€ã„ã¾ã™ãŒï¼ŒRepository ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å³æ ¼ã«ã‚„ã‚ã†ã¨ã™ã‚‹å ´åˆï¼ŒInsert ã¨ Update ã®åŒºåˆ¥ã¯ã¤ã‘ãšä¸€ã¤ã® `save()` ã¨ã„ã†ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã§æ›´æ–°ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ï¼

ãã†ã™ã‚‹ã¨ï¼ŒID ãŒ save å‰ã«æ±ºã¾ã‚‰ãªã„ AutoIncrement ã¯éƒ½åˆãŒæ‚ªã„ã‚ã‘ã§ã™ï¼

UUID ã§ã‚ã‚Œã°ï¼Œï¼ˆè¶…é«˜ç¢ºç‡ã§ï¼‰è¡çªã‚’å›é¿ã—ãªãŒã‚‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§æ¡ç•ªã®è²¬å‹™ã‚’æ‹…ã†ã“ã¨ãŒã§ãã¾ã™ï¼

ã¾ãŸï¼ŒEntity ã‚’ç”Ÿæˆã—ãŸæ™‚ç‚¹ã§ ID ãŒç¢ºå®šã—ã¦ã„ã‚‹ã®ã§ï¼Œæˆ»ã‚Šå€¤ã®æ§‹ç¯‰ã‚„é–¢é€£ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¸ã® ID å¼•ãæ¸¡ã—ã‚‚ã‚¹ãƒ ãƒ¼ã‚ºã«ãªã‚Šã¾ã™ï¼

:::details ProjectFactory
```php
class ProjectFactory
{
    public function __construct(
        private IdGenerator $idGenerator,
    ) {}

    public function create(
        string $name,
        ?ClientId $clientId,
        MemberId $managerId,
        LocalDate $since,
        LocalDate $until,
        ProjectType $type,
    ): Project {
        return new Project(
            id: ProjectId::create($this->idGenerator->generate()),
            name: $name,
            clientId: $clientId,
            managerId: $managerId,
            period: new DateRange($since, $until),
            type: $type,
        );
    }

    public function reconstruct(
        string $id,
        string $name,
        ?string $clientId,
        string $managerId,
        string $since,
        string $until,
        string $type,
    ): Project {
        return new Project(
            id: ProjectId::create($id),
            name: $name,
            clientId: ClientId::createOrNull($clientId),
            managerId: MemberId::create($managerId),
            period: new DateRange(
                LocalDate::parse($since),
                LocalDate::parse($until),
            ),
            type: ProjectType::from($type),
        );
    }
}
```
:::

:::message
#### IdGenerator ã¨ App\Support ã«ã¤ã„ã¦

å‰è¿°ã—ãŸ Factory ã¯ IdGenerator ã«ä¾å­˜ã—ã¦ã„ã¾ã—ãŸï¼
Laravel ã§ã¯ `Str::uuid()` ã‚„ `Str::uuid7()` ã‚’ä½¿ã£ã¦ UUID ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒï¼ŒDomain å±¤ã§ã¯ã§ãã‚‹ã ã‘ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ä¾å­˜ã—ãŸããªã„ã¨ã„ã†ç†ç”±ï¼Œstatic ãªãƒ˜ãƒ«ãƒ‘ã§ã¯ãªã DI ã—ãŸã„ã¨ã„ã†ç†ç”±ã‹ã‚‰æœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯è‡ªå‰ã§å®Ÿè£…ã—ã¦ã„ã¾ã™ï¼

è‡ªå‰å®Ÿè£…ã¨ã¯è¨€ã„ã¤ã¤ï¼Œãƒ­ã‚¸ãƒƒã‚¯æœ¬ä½“ã¯ `ramsey/uuid` ã‚’åˆ©ç”¨ã—ã¾ã™ï¼

https://github.com/ramsey/uuid

`UuidGenerator` ã® Interface ã¯ `Contract/Kernel` ã«å®šç¾©ã—ï¼Œå®Ÿè£…ã¯ `App\Support` ã«ç½®ãã¾ã™ï¼

```
modules/
â””â”€â”€ Contract/
    â””â”€â”€ Kernel/
        â””â”€â”€ Id/
            â””â”€â”€ UuidGenerator.php  â† Interface

app/
â””â”€â”€ Support/
    â””â”€â”€ Id/
        â”œâ”€â”€ RamseyUuidGenerator.php  â† æœ¬ç•ªç”¨å®Ÿè£…
        â””â”€â”€ FixedUuidGenerator.php   â† ãƒ†ã‚¹ãƒˆç”¨å®Ÿè£…ï¼ˆå¿…è¦ã§ã‚ã‚Œã°ï¼‰
```

##### ãªãœåˆ†é›¢ã™ã‚‹ã®ã‹ï¼Ÿ

Contract ã¯ã€Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®å…¬é–‹ APIã€ã§ã‚ã‚Šï¼Œç´”ç²‹ãª PHP ã§è¨˜è¿°ã—ã¾ã™ï¼
`ramsey/uuid` ã®ã‚ˆã†ãªå¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ã®ä¾å­˜ã¯ Contract ã«æŒã¡è¾¼ã¿ãŸãã‚ã‚Šã¾ã›ã‚“ï¼

ãã“ã§ï¼ŒInterface ã ã‘ã‚’ Contract ã«å®šç¾©ã—ï¼Œå®Ÿè£…ã¯ `App\Support`ï¼ˆmodules ã®å¤–ï¼‰ã«ç½®ãã¾ã™ï¼
ã“ã‚Œã«ã‚ˆã‚Š Contract ã®ç´”ç²‹æ€§ã‚’ä¿ã¡ã¤ã¤ï¼Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ¨ªæ–­ã§å®Ÿè£…ã‚’å…±æœ‰ã§ãã¾ã™ï¼

##### ãªãœ Support Module ã«ã—ãªã„ã®ã‹ï¼Ÿ

ã€Œmodules/Support ã‚’ä½œã‚Œã°ã„ã„ã®ã§ã¯ï¼Ÿã€ã¨æ€ã†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼

Module ã¯ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³ã€ã‚’è¡¨ç¾ã™ã‚‹å˜ä½ã§ã™ï¼
UUID ç”Ÿæˆã®ã‚ˆã†ãªæŠ€è¡“çš„ãªå…±é€šåŸºç›¤ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã¯ãªã„ã®ã§ï¼ŒModule ã¨ã—ã¦åˆ‡ã‚Šå‡ºã™ã®ã¯æ„å‘³çš„ã«é•å’Œæ„ŸãŒã‚ã‚Šã¾ã™ï¼

ã¾ãŸï¼ŒModule é–“ã®ä¾å­˜ã¯ Contract çµŒç”±ãŒåŸå‰‡ã§ã™ãŒï¼Œ`App\Support` ã¯å…¨ Module ã§å…±æœ‰ã—ãŸã„ã€ŒæŠ€è¡“çš„ãªå®Ÿè£…ç½®ãå ´ã€ã¨ã—ã¦ï¼ˆmodules ã®å¤–ã«ï¼‰ç½®ãã¾ã™ï¼

ã“ã“ã§è¨€ã†ã€Œå…±æœ‰ã€ã¨ã¯ **å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚³ãƒ¼ãƒ‰ãŒ `App\Support` ã®å…·è±¡ã‚¯ãƒ©ã‚¹ã«ä¾å­˜ã™ã‚‹**ã¨ã„ã†æ„å‘³ã§ã¯ãªãï¼Œ**å‚ç…§ã™ã‚‹ã®ã¯ã‚ãã¾ã§ `Contract/Kernel` ã® interface ã ã‘**ã§ï¼Œ`App\Support` ã®å®Ÿè£…ã¯ ServiceProvider ãªã©ã® DI è¨­å®šï¼ˆComposition Rootï¼‰ã§ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹ï¼Œã¨ã„ã†æ„å›³ã§ã™ï¼

ã¾ãŸ deptrac ã¯ï¼ˆå¾Œè¿°ã®ä¾‹ã®ã‚ˆã†ã«ï¼‰`paths` ã‚’ `./modules` ã«çµã£ã¦ã„ã‚Œã° `App\Support` ã¯è§£æå¯¾è±¡å¤–ãªã®ã§ï¼Œè¨­å®šã‚’è¤‡é›‘ã«ã›ãšã«é‹ç”¨ã§ãã¾ã™ï¼ˆã‚‚ã— `app/` ã‚‚è§£æå¯¾è±¡ã«å«ã‚ã‚‹ãªã‚‰ï¼Œ`App\Support` ã‚’å…±æœ‰ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦å®šç¾©ã—ï¼Œå„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ã®ä¾å­˜ã‚’æ˜ç¤ºã—ã¾ã™ï¼‰ï¼

ä¾å­˜é–¢ä¿‚ã‚’å›³ã«ã™ã‚‹ã¨ã“ã‚“ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ï¼š

```mermaid
graph TB
    subgraph Contract
        IF["modules/Contract/Kernel<br/>UuidGenerator (interface)"]
    end

    subgraph Support
        IMPL["app/Support<br/>RamseyUuidGenerator (implements)"]
    end

    subgraph Modules
        M1["modules/Member"]
        M2["modules/Project"]
        M3["modules/..."]
    end

    %% ä¾å­˜ï¼ˆå‚ç…§ï¼‰ã¯ interface ã®ã¿
    M1 --> IF
    M2 --> IF
    M3 --> IF

    %% å®Ÿè£…ã¯ Support å´ï¼ˆDI ã§å·®ã—æ›¿ãˆã‚‹ï¼‰
    IMPL -.-> IF
```

```php
// Contract/Kernel/Id/UuidGenerator.php
interface UuidGenerator
{
    public function generate(): string;
}

// App\Support\Id\RamseyUuidGenerator.php
use Ramsey\Uuid\Uuid;

class RamseyUuidGenerator implements UuidGenerator
{
    public function generate(): string
    {
        return Uuid::uuid7()->toString();
    }
}

// App\Support\Id\FixedUuidGenerator.phpï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
class FixedUuidGenerator implements UuidGenerator
{
    public function __construct(
        private string $value = 'test-uuid',
    ) {}

    public function generate(): string
    {
        return $this->value;
    }
}
```

##### UUID v7 ã‚’æ¡ç”¨

æœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ UUID v7 ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ï¼
ãƒãƒ¼ã‚¸ãƒ§ãƒ³é¸å®šã®è©³ç´°ã«ã¤ã„ã¦ã¯ï¼Œä»¥ä¸‹ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã™ï¼

https://zenn.dev/mpyw/articles/rdb-ids-and-timestamps-best-practices
:::

### Infrastructure å±¤

æŠ€è¡“çš„è©³ç´°ã‚’æ‹…å½“ã—ã¾ã™ï¼ä¸»ã« DB ã‚¢ã‚¯ã‚»ã‚¹ï¼ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ä¾å­˜ã‚’æ°—ã«ã—ãªãã¦è‰¯ã„éƒ¨åˆ†ã«ãªã‚Šã¾ã™ï¼

| ã‚¯ãƒ©ã‚¹ | è²¬å‹™ |
|-------|------|
| **Repositoryï¼ˆå®Ÿè£…ï¼‰** | Domain ã® Repository Interface ã‚’å®Ÿè£… |
| **Eloquent Model** | DB ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã®ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ã®å…¥å£ã¨ã—ã¦ä½¿ã† |
| **ExceptionHandler** | DB ä¾‹å¤–ã‚’ Domain ä¾‹å¤–ã«å¤‰æ› |
| **QueryServiceï¼ˆå®Ÿè£…ï¼‰** | Domain / Contract ã® QueryService Interface ã‚’å®Ÿè£… |

#### Eloquent Model ã«ã¤ã„ã¦

ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãªã© Eloquent Model ã®ä¾¿åˆ©æ©Ÿèƒ½ã¯ã»ã¨ã‚“ã©ä½¿ã‚ãªã„ã®ã§ã¶ã£ã¡ã‚ƒã‘ç”Ÿã® QueryBuilder ã‚’ä½¿ã£ã¦ã‚‚è‰¯ã„ã®ã§ã™ãŒï¼Œãƒ†ãƒ¼ãƒ–ãƒ«åã‚„ Connection ã®ä¸€å…ƒç®¡ç†ï¼ŒCast ã‚ãŸã‚Šã¯ä¾¿åˆ©ãªã®ã§ãã®ã¾ã¾ä½¿ã„ã¾ã™ï¼

ã¾ãŸï¼ŒåŒä¸€ Module å†…ã§ã‚ã‚Œã° Eloquent ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©ã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ï¼
Infrastructure å±¤å†…ã§å®Œçµã™ã‚‹ã®ã§ï¼Œãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ä¾å­˜é•åã«ã¯ãªã‚Šã¾ã›ã‚“ï¼

ãŸã ã—ï¼Œ**ä»– Module ã® Model ã¸ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ NG** ã§ã™ï¼
Module å¢ƒç•Œã‚’è¶Šãˆã‚‹å ´åˆã¯ Contract çµŒç”±ã§ QueryService ã‚’ä½¿ã„ã¾ã™ï¼

#### ExceptionHandler ã«ã¤ã„ã¦

Eloquent ã®ä¾‹å¤–ï¼ˆ`UniqueConstraintViolationException` ãªã©ï¼‰ã¯ Infrastructure å±¤ã®è©³ç´°ã§ã‚ã‚Šï¼ŒApplication å±¤ã«æ¼ã‚‰ã—ãŸãã‚ã‚Šã¾ã›ã‚“ï¼
ExceptionHandler ã§ DomainException ã«å¤‰æ›ã—ã¦ï¼Œãƒ‰ãƒ¡ã‚¤ãƒ³çš„æ„å‘³ã‚’æŒãŸã›ã¾ã™ï¼

ã¾ãšï¼ŒContract/Kernel ã«æŠ½è±¡ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¾ã™ï¼

:::details AbstractDatabaseExceptionHandler
```php
abstract class AbstractDatabaseExceptionHandler
{
    /**
     * é€šå¸¸ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ
     * @template T
     * @param callable(): T $callback
     * @return T
     */
    public function perform(callable $callback): mixed
    {
        try {
            return $callback();
        } catch (Throwable $throwable) {
            throw $this->convertOrThrow($throwable);
        }
    }

    /**
     * Generator å¯¾å¿œï¼ˆLazyCollection ç”¨ï¼‰
     * @template K of array-key
     * @template V
     * @param callable(): iterable<K, V> $callback
     * @return Generator<K, V>
     */
    public function lazy(callable $callback): Generator
    {
        try {
            yield from $callback();
        } catch (Throwable $throwable) {
            throw $this->convertOrThrow($throwable);
        }
    }

    private function convertOrThrow(Throwable $throwable): Throwable
    {
        // æ—¢ã«å¤‰æ›æ¸ˆã¿ãªã‚‰ãã®ã¾ã¾
        if ($throwable instanceof ConnectionException) {
            return $throwable;
        }

        // PDOException ãªã‚‰å¤‰æ›
        if ($throwable instanceof PDOException) {
            return $this->convert($throwable);
        }

        // ãã‚Œä»¥å¤–ã¯ãã®ã¾ã¾å†é€å‡º
        return $throwable;
    }

    /**
     * ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å›ºæœ‰ã® ConnectionException ã«å¤‰æ›
     */
    abstract protected function convert(Throwable $throwable): ConnectionException;
}
```
:::

å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã¯ï¼Œã“ã®æŠ½è±¡ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ã¦ `convert()` ã‚’å®Ÿè£…ã™ã‚‹ã ã‘ã§ã™ï¼

:::details ProjectDatabaseExceptionHandler
```php
final class ProjectDatabaseExceptionHandler extends AbstractDatabaseExceptionHandler
{
    protected function convert(Throwable $throwable): ConnectionException
    {
        return new ProjectConnectionException(
            $throwable->getMessage(),
            previous: $throwable,
        );
    }
}
```
:::

`lazy()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹ã“ã¨ã§ï¼ŒQueryService ã§ `LazyCollection`ï¼ˆGeneratorï¼‰ã‚’è¿”ã™å ´åˆã§ã‚‚ä¾‹å¤–ã‚’é©åˆ‡ã«ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§ãã¾ã™ï¼

Repository ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ä½¿ã„ã¾ã™ï¼

:::details ProjectRepository
```php
class ProjectRepository implements ProjectRepositoryInterface
{
    public function __construct(
        private ProjectFactory $factory,
        private ProjectDatabaseExceptionHandler $exceptionHandler,
    ) {}

    public function save(Project $project): void
    {
        $this->exceptionHandler->perform(function () use ($project) {
            ProjectModel::query()->updateOrCreate(
                ['id' => $project->id->unwrap()],
                [
                    'name' => $project->name,
                    'client_id' => $project->clientId?->unwrap(),
                    'manager_id' => $project->managerId->unwrap(),

                    // PostgreSQL ã ã¨ Range å‹ã‚’ä½¿ã†ã¹ãã§ã™ãŒï¼Œæœ¬è¨˜äº‹ã§ã¯ã‚¹ã‚³ãƒ¼ãƒ—å¤–ã¨ã—ã¾ã™
                    'since' => $project->period->since,
                    'until' => $project->period->until,

                    'type' => $project->type->value,
                ],
            );
        });
    }

    public function findById(ProjectId $id): Project
    {
        return $this->exceptionHandler->perform(function () use ($id) {
            $model = ProjectModel::query()->findOrFail($id->unwrap());

            return $this->factory->reconstruct(
                id: $model->id,
                name: $model->name,
                clientId: $model->client_id,
                managerId: $model->manager_id,
                since: $model->since,
                until: $model->until,
                type: $model->type,
            );
        });
    }
}
```
:::

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†…æœ€çµ‚ç³»

ä»Šå›ã¯ Project ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ Store å‡¦ç†ã‚’å®Ÿè£…ã—ãŸã¨ä»®å®šã—ãŸï¼”å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æœ€çµ‚ç³»ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ï¼

```
modules/Project/
â”œâ”€â”€ ModuleServiceProvider.php
â”œâ”€â”€ Presentation/
â”‚   â”œâ”€â”€ ProjectController.php
â”‚   â”œâ”€â”€ StoreProjectRequest.php
â”‚   â””â”€â”€ ProjectInputAssembler.php
â”œâ”€â”€ Application/
â”‚   â”œâ”€â”€ StoreProjectUseCase.php       # Interface
â”‚   â”œâ”€â”€ StoreProjectInteractor.php    # å®Ÿè£…
â”‚   â”œâ”€â”€ StoreProjectInput.php
â”‚   â””â”€â”€ StoreProjectOutput.php
â”œâ”€â”€ Domain/
â”‚   â”œâ”€â”€ Project.php                   # Entity
â”‚   â”œâ”€â”€ ProjectRepository.php         # Interface
â”‚   â”œâ”€â”€ ProjectFactory.php
â”‚   â””â”€â”€ Policies/
â”‚       â””â”€â”€ StoreProjectPolicy.php
â””â”€â”€ Infrastructure/
    â”œâ”€â”€ ProjectRepository.php         # å®Ÿè£…
    â”œâ”€â”€ ProjectDatabaseExceptionHandler.php
    â””â”€â”€ Models/
        â””â”€â”€ ProjectModel.php          # Eloquent
```

### deptrac ã‚’ä½¿ã£ãŸé™çš„æ¤œæŸ»

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã®ã¨ãã«ã‚‚ç™»å ´ã—ãŸ deptrac ã§ã™ãŒï¼Œï¼”å±¤ã®ä¾å­˜ãƒ«ãƒ¼ãƒ«ã®å®šç¾©ã«ã‚‚ä½¿ãˆã¾ã™ï¼

:::details deptrac/layer.yaml
```yaml
# deptrac/layer.yaml
deptrac:
  paths:
    - ./modules
  exclude_paths:
    - ./modules/Contract
  exclude_files:
    # ä»»æ„ã®éšå±¤ã«å‡ºç¾ã™ã‚‹ test / tests ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã‚’é™¤å¤– (å¤§æ–‡å­—å°æ–‡å­—ç„¡è¦–)
    - '#.*/[Tt]est[s]?/.*#'

  layers:
    - name: Presentation
      collectors:
        - type: directory
          value: modules/.*/Presentation/.*
    - name: Application
      collectors:
        - type: directory
          value: modules/.*/Application/.*
    - name: Domain
      collectors:
        - type: directory
          value: modules/.*/Domain/.*
    - name: Infrastructure
      collectors:
        - type: directory
          value: modules/.*/Infrastructure/.*

  ruleset:
    Presentation:
      - Presentation
      - Application
    Application:
      - Application
      - Domain
    Domain:
      - Domain
    Infrastructure:
      - Infrastructure
      - Domain
```
:::

:::message
**ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®æ©Ÿèƒ½ã‚‚åˆ¶é™ã§ãã‚‹**

deptrac ã§ã¯å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã€Œãƒ¬ã‚¤ãƒ¤ãƒ¼ã€ã¨ã—ã¦å®šç¾©ã—ï¼Œå±¤ã”ã¨ã«è¨±å¯ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ¶é™ã§ãã¾ã™ï¼

#### ä¾‹

```yaml
layers:
  # Illuminate Collections: Application å±¤ã§è¨±å¯
  - name: IlluminateCollections
    collectors:
      - type: classNameRegex
        value: '#^Illuminate\\Support\\(Collection|LazyCollection)$#'

  # Brick DateTime: Domain/Application å±¤ã§è¨±å¯
  - name: BrickDateTime
    collectors:
      - type: classNameRegex
        value: '#^Brick\\DateTime\\.+$#'

  # Illuminate Database: Infrastructure å±¤ã§ã®ã¿è¨±å¯
  - name: IlluminateDatabase
    collectors:
      - type: classNameRegex
        value: '#^Illuminate\\Database\\.+$#'

ruleset:
  Domain: [ Domain, BrickDateTime ]
  Application: [ Application, Domain, IlluminateCollections, BrickDateTime ]
  Infrastructure: [ Infrastructure, Domain, IlluminateCollections, BrickDateTime, IlluminateDatabase ]
  Presentation: [ Presentation, Application, BrickDateTime ]
```

ã“ã‚Œã«ã‚ˆã‚Šã€ŒDomain å±¤ã§ Eloquent ã‚’ä½¿ã£ã¦ã—ã¾ã£ãŸã€ã¨ã„ã£ãŸäº‹æ•…ã‚’é™çš„è§£æã§æ¤œå‡ºã§ãã¾ã™ï¼
:::

# å®Ÿè£… Tips é›†

ã“ã‚Œã¾ã§ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ä¸­ã«ã—ã‚Œã£ã¨å‡ºã¦ããŸæ¦‚å¿µã‚„ï¼Œâ€å¾Œè¿°â€ ã§å¾Œå›ã—ã«ã—ã¦ããŸã‚ªãƒªã‚¸ãƒŠãƒ«ã®ä»•çµ„ã¿ãªã©ã‚’ç´¹ä»‹ã—ã¾ã™ï¼
ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã‚„ï¼”å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ã‚„ã‚‹ä¸Šã§ç‰¹ã«é‡è¦ãªã‚‚ã®ã‚’ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã„ã¾ã™ï¼

## å‹å®‰å…¨ãª IDï¼ˆHasId ãƒˆãƒ¬ã‚¤ãƒˆï¼‰

ID ã‚’ `string` ã®ã¾ã¾æ‰±ã£ã¦ã„ã‚‹ã¨ï¼Œç•°ãªã‚‹æ¦‚å¿µã® ID ã‚’å–ã‚Šé•ãˆã‚‹äº‹æ•…ãŒèµ·ãã¾ã™ï¼
ä¾‹ãˆã° `MemberId` ã¨ `ProjectId` ã‚’é–“é•ãˆã¦æ¸¡ã—ã¦ã—ã¾ã£ã¦ã‚‚ï¼Œå‹ã¨ã—ã¦ã¯åŒã˜ `string` ãªã®ã§é™çš„è§£æã§èª¤ã‚Šã‚’æ¤œå‡ºã§ãã¾ã›ã‚“ï¼

ãã“ã§ï¼ŒID å°‚ç”¨ã® Value Object ã‚’ä½œã‚Šï¼Œå‹ã§åŒºåˆ¥ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ï¼

### å®Ÿè£…æ–¹é‡

`mpyw/sharable-value-objects` ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã„ã¾ã™ï¼

https://github.com/mpyw/sharable-value-objects

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã€ŒåŒã˜å€¤ãªã‚‰åŒã˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™ã€Flyweight ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿç¾ã—ã¾ã™ï¼
ã“ã‚Œã«ã‚ˆã‚Š `===` ã§ã®å³å¯†æ¯”è¼ƒãŒå¯èƒ½ã«ãªã‚Šï¼Œãƒ†ã‚¹ãƒˆã‚„ãƒ¢ãƒƒã‚¯ã®å¯èª­æ€§ãŒä¸ŠãŒã‚Šã¾ã™ï¼

### HasId ãƒˆãƒ¬ã‚¤ãƒˆ

Contract/Kernel ã«å…±é€šãƒˆãƒ¬ã‚¤ãƒˆã‚’ç”¨æ„ã—ã¾ã™ï¼

```php
namespace Modules\Contract\Kernel\Id;

use Mpyw\SharableValueObjects\SharableString;

trait HasId
{
    use SharableString;

    public static function create(string $id): static
    {
        return static::acquire($id);  // WeakReference ãƒ—ãƒ¼ãƒ«ã‹ã‚‰å–å¾—
    }

    public static function createOrNull(?string $id): ?static
    {
        return $id !== null ? static::create($id) : null;
    }

    public function unwrap(): string
    {
        return $this->getOriginalValue();
    }
}
```

### ID ã‚¯ãƒ©ã‚¹ã®å®šç¾©

å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® Contract ã§ ID ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã—ã¾ã™ï¼
`HasId` ã‚’ use ã™ã‚‹ã ã‘ã§ï¼Œè¿½åŠ å®Ÿè£…ã¯ä¸è¦ã§ã™ï¼

```php
namespace Modules\Contract\Member\Identities;

use Modules\Contract\Kernel\Id\HasId;

final class MemberId
{
    use HasId;
}
```

```php
namespace Modules\Contract\Project\Identities;

use Modules\Contract\Kernel\Id\HasId;

final class ProjectId
{
    use HasId;
}
```

### ä½¿ã„æ–¹

```php
// ç”Ÿæˆ
$id = MemberId::create('550e8400-e29b-41d4-a716-446655440000');
$nullableId = MemberId::createOrNull($input->managerId);

// å–ã‚Šå‡ºã—ï¼ˆDB ä¿å­˜æ™‚ãªã©ï¼‰
$raw = $id->unwrap();

// æ¯”è¼ƒï¼ˆåŒå€¤ãªã‚‰åŒä¸€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
$a = MemberId::create('u_1');
$b = MemberId::create('u_1');
assert($a === $b);  // true
```

### ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³

```php
// âŒ __toString() ã®å®Ÿè£…ã¯ç¦æ­¢ï¼ˆæš—é»™å¤‰æ›ã®äº‹æ•…ã‚’é˜²ãï¼‰
final class MemberId {
    use HasId;
    public function __toString(): string { ... }  // NG!!
}

// âŒ new ç›´å‘¼ã³ã¯ç¦æ­¢ï¼ˆcreate çµŒç”±ã®ã¿ï¼‰
$id = new MemberId('xxx');  // NG!!
```

ãã‚‚ãã‚‚ SharableString ãƒˆãƒ¬ã‚¤ãƒˆãŒã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ private ã«ã™ã‚‹ã®ã§ new ã§ããªã„ã§ã™ãŒå¿µã®ç‚ºï¼
ãªãœç›´æ¥ new ã•ã›ãŸããªã„ã‹ã¨ã„ã†ã¨ï¼ŒWeakReference ãƒ—ãƒ¼ãƒ«ã‚’çµŒç”±ã—ãªã„ã‹ã‚‰ã§ã™ã­ï¼ã“ã‚Œã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å®Ÿè£…ã‚’èª­ã‚€ã¨æ„å‘³ãŒã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ï¼

:::message
**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦**

HasId ã§ã¯ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼ï¼ˆUUID å½¢å¼ãªã©ï¼‰ã‚’è¡Œã„ã¾ã›ã‚“ï¼
Contract ã«ã¯ã€Œãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒã¡è¾¼ã¾ãªã„ã€ã¨ã„ã†æ–¹é‡ã®ãŸã‚ã§ã™ï¼

å½¢å¼æ¤œè¨¼ãŒå¿…è¦ãªå ´åˆã¯ï¼ŒPresentation å±¤ã® FormRequest ã‚„ Application å±¤ã§è¡Œã„ã¾ã™ï¼
:::

## ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®æŠ½è±¡åŒ–

4 å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚‚è§¦ã‚Œã¾ã—ãŸãŒï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ã«ã¤ã„ã¦è£œè¶³ã—ã¾ã™ï¼

### DDD çš„è¦‹è§£ã¨æœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ–¹é‡

DDD ã§ã¯ï¼Œãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã¯ã€Œé›†ç´„ï¼ˆAggregateï¼‰ã€å˜ä½ã§è¨­ã‘ã‚‹ã®ãŒåŸå‰‡ã§ã™ï¼
é›†ç´„ã¨ã¯æ•´åˆæ€§ã‚’ä¿ã¤ã¹ãã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¾ã¨ã¾ã‚Šã§ã‚ã‚Šï¼ŒRepository ã¯é›†ç´„ã«å¯¾ã—ã¦ã®ã¿æä¾›ã•ã‚Œã¾ã™ï¼

ã—ã‹ã—ï¼Œ**é›†ç´„ã¨ Repository ã¯åˆ¥æ¦‚å¿µ**ã§ã™ï¼
é›†ç´„ã¯ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«ã«åŸºã¥ãæ•´åˆæ€§ã®å¢ƒç•Œã€ï¼ŒRepository ã¯ã€Œæ°¸ç¶šåŒ–ã®çª“å£ã€ã§ã‚ã‚Šï¼Œå¢ƒç•ŒãŒä¸€è‡´ã™ã‚‹ã®ã¯çµæœã§ã‚ã£ã¦å®šç¾©ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼

æœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯ï¼Œã‚ˆã‚Šå®Ÿè·µçš„ã« **UseCaseï¼ˆInteractorï¼‰ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’è²¼ã‚‹**æ–¹é‡ã‚’å–ã‚Šã¾ã™ï¼

### ãªãœæŠ½è±¡åŒ–ã™ã‚‹ã®ã‹

- ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å…¨ä½“ã‚’ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã«ã—ãŸã„
- è¤‡æ•°ã® Repository ã‚’è·¨ã„ã§æ•´åˆæ€§ã‚’å–ã‚ŠãŸã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹ï¼ˆä¾‹ï¼šRequirement ã‚’å‰Šé™¤ã—ã¦ Assignment ã‚’ä½œæˆï¼‰
- Laravel ä¾å­˜ã‚’ Contract å±¤ã¸æ¼ã‚‰ã•ãªã„

### å¥‘ç´„ï¼ˆContract/Kernelï¼‰

```php
namespace Modules\Contract\Kernel\Persistence;

interface TransactionExecutor
{
    /**
     * @template T
     * @param callable(): T $callback
     * @return T
     */
    public function execute(callable $callback): mixed;
}
```

### å®Ÿè£…ï¼ˆApp\Supportï¼‰

```php
namespace App\Support\Persistence;

use Illuminate\Database\ConnectionInterface;
use Modules\Contract\Kernel\Persistence\TransactionExecutor;

class LaravelTransactionExecutor implements TransactionExecutor
{
    public function __construct(
        private ConnectionInterface $connection,
    ) {}

    public function execute(callable $callback): mixed
    {
        return $this->connection->transaction($callback);
    }
}
```

Laravel æ¨™æº–ã®ãƒã‚¹ãƒˆå‡¦ç†ãƒ»ãƒªãƒˆãƒ©ã‚¤ãƒ»ä¾‹å¤–å¤‰æ›ã«ä»»ã›ï¼Œç‹¬è‡ªå®Ÿè£…ã¯é¿ã‘ã¾ã™ï¼

### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã§ã®é©ç”¨

æ›¸ãè¾¼ã¿ç³» Interactor ã§ã¯åŸå‰‡ã¨ã—ã¦ `TransactionExecutor` ã‚’æ³¨å…¥ã—ï¼Œå‡¦ç†å…¨ä½“ã‚’ `execute()` ã§ãƒ©ãƒƒãƒ—ã—ã¾ã™ï¼

```php
public function __invoke(StoreMemberInput $input): StoreMemberOutput
{
    return $this->transactions->execute(function () use ($input): StoreMemberOutput {
        $member = $this->factory->create(...);
        $this->repository->save($member);

        return StoreMemberOutput::fromEntity($member);
    });
}
```

:::message
**1 ãƒ†ãƒ¼ãƒ–ãƒ« 1 ãƒ¬ã‚³ãƒ¼ãƒ‰ã§ã‚‚å¿…è¦ï¼Ÿ**

å˜ç´”ãªæ›´æ–°ã¯ DB ãŒæš—é»™ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼
ã—ã‹ã—ï¼Œä»¥ä¸‹ã®ç†ç”±ã‹ã‚‰ Interactor å´ã§å¢ƒç•Œã‚’è¨­ã‘ã‚‹ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ï¼š

- Infrastructure å®Ÿè£…ãŒå°†æ¥è¤‡æ•° SQL ã«æ‹¡å¼µã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- å‰¯ä½œç”¨ã®å¢ƒç•Œã‚’æ˜ç¤ºã§ãï¼Œã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚ã«æ„å›³ãŒä¼ã‚ã‚‹
:::

### Repository ã§ã‚‚é˜²å¾¡çš„ã«è²¼ã£ã¦ãŠãã¨å®‰å¿ƒ

UseCase ã§è²¼ã‚‹ã®ãŒåŸºæœ¬ã§ã™ãŒï¼ŒRepository å†…ã§è¤‡æ•°ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°ã™ã‚‹å ´åˆã¯ï¼Œé˜²å¾¡çš„ã«è²¼ã£ã¦ãŠãã¨å®‰å¿ƒã§ã™ï¼

```php
// Repository å†…ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’è²¼ã‚‹ä¾‹
public function save(Member $member): void
{
    $this->transactions->execute(function () use ($member) {
        MemberModel::query()->updateOrCreate(...);
        HistoryModel::query()->create(...);  // å±¥æ­´ã‚‚ä¸€ç·’ã«ä¿å­˜
    });
}
```

### ãƒã‚¹ãƒˆã—ãŸãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³

Laravel ã¯å†…éƒ¨çš„ã«ã‚«ã‚¦ãƒ³ã‚¿ã‚’ç®¡ç†ã—ï¼Œæœ€å¤–å‘¨ã®ã¿ commit ã—ã¾ã™ï¼
UseCase ã¨ Repository ã®ä¸¡æ–¹ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’è²¼ã£ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ï¼

```
UseCase: BEGIN (ã‚«ã‚¦ãƒ³ãƒˆ=1)
  â””â”€ Repository: BEGIN (ã‚«ã‚¦ãƒ³ãƒˆ=2, savepoint)
     â””â”€ INSERT ...
  â””â”€ Repository: COMMIT (ã‚«ã‚¦ãƒ³ãƒˆ=1, savepointè§£æ”¾)
UseCase: COMMIT (ã‚«ã‚¦ãƒ³ãƒˆ=0, å®Ÿéš›ã®COMMIT)
```

ã“ã®ä»•çµ„ã¿ã®ãŠã‹ã’ã§ï¼ŒUseCase ã§ã¯ã€Œãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å…¨ä½“ã®æ•´åˆæ€§ã€ã‚’æ‹…ä¿ã—ï¼ŒRepository ã§ã¯ã€Œè‡ªåˆ†ã®è²¬å‹™ã§å¿…è¦ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚’é˜²å¾¡çš„ã«è²¼ã‚‹ï¼Œã¨ã„ã†å®‰å¿ƒè¨­è¨ˆãŒã§ãã¾ã™ï¼

### ãƒ†ã‚¹ãƒˆæ™‚ã®ãƒ•ã‚§ã‚¤ã‚¯

```php
namespace Tests\Support\Persistence;

class InMemoryTransactionExecutor implements TransactionExecutor
{
    public function execute(callable $callback): mixed
    {
        return $callback();  // å³æ™‚å®Ÿè¡Œã™ã‚‹ã ã‘
    }
}
```

Unit ãƒ†ã‚¹ãƒˆã§ã¯ã“ã®ãƒ•ã‚§ã‚¤ã‚¯ã‚’ä½¿ã†ã“ã¨ã§ï¼Œé«˜é€Ÿã§å®‰å®šã—ãŸãƒ†ã‚¹ãƒˆãŒæ›¸ã‘ã¾ã™ï¼

## ä¾‹å¤–è¨­è¨ˆ

Infrastructure å±¤ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ `DatabaseExceptionHandler` ã‚’ç´¹ä»‹ã—ã¾ã—ãŸãŒï¼Œã“ã“ã§ã¯ä¾‹å¤–ã®å…¨ä½“è¨­è¨ˆã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ï¼

### 2 ç¨®é¡ã®ä¾‹å¤–

ä¾‹å¤–ã¯å¤§ãã 2 ã¤ã«åˆ†é¡ã—ã¾ã™ï¼

| ç¨®é¡ | ç”¨é€” | HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|------|----------------|
| **DomainException** | ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é•åï¼Œãƒªã‚½ãƒ¼ã‚¹æœªç™ºè¦‹ãªã© | 400 / 404 |
| **TechnicalException** | DB æ¥ç¶šã‚¨ãƒ©ãƒ¼ï¼Œå¤–éƒ¨ API éšœå®³ãªã© | 500 |

```php
// Contract/Kernel/Exception/DomainException.php
abstract class DomainException extends \Exception {}

// Contract/Kernel/Exception/TechnicalException.php
abstract class TechnicalException extends \RuntimeException {}
```

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒãƒ¼ã‚«ãƒ¼ Interface

å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ `ModuleException` ã‚’ç¶™æ‰¿ã—ãŸãƒãƒ¼ã‚«ãƒ¼ Interface ã‚’å®šç¾©ã—ã¾ã™ï¼
ä¾‹å¤–ãŒã“ã‚Œã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã§ï¼Œã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ç™ºç”Ÿã—ãŸã‹ãŒå‹ã§åˆ¤åˆ¥ã§ãã¾ã™ï¼

```php
// Contract/Kernel/Exception/ModuleException.php
interface ModuleException {}

// Contract/Project/Exceptions/ProjectModuleException.php
interface ProjectModuleException extends ModuleException {}

// Contract/Project/Exceptions/ProjectNotFoundException.php
final class ProjectNotFoundException extends DomainException 
    implements ProjectModuleException {}
```

### NotFoundException ãƒãƒ¼ã‚«ãƒ¼

DomainException ã®ä¸­ã§ã‚‚ã€Œãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã€ã¯ç‰¹æ®Šãªã‚±ãƒ¼ã‚¹ã§ã™ï¼
HTTP çš„ã«ã¯ 400 ã§ã¯ãªã 404 ã‚’è¿”ã™ã¹ãã§ã™ãŒï¼ŒDomain å±¤ã« HTTP ã®çŸ¥è­˜ã‚’æŒã¡è¾¼ã¿ãŸãã¯ã‚ã‚Šã¾ã›ã‚“ï¼

ãã“ã§ `NotFoundException` ã¨ã„ã†ãƒãƒ¼ã‚«ãƒ¼ Interface ã‚’ç”¨æ„ã—ã¾ã™ï¼
Domain å±¤ã§ã¯ã€Œè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã€ã¨ã„ã†æ„å‘³ã ã‘ã‚’è¡¨ç¾ã—ï¼Œãã‚ŒãŒ HTTP 404 ã«ãªã‚‹ã‹ã¯ ExceptionHandlerï¼ˆbootstrap/app.phpï¼‰å´ã§åˆ¤æ–­ã—ã¾ã™ï¼

```php
// Contract/Kernel/Exception/NotFoundException.php
interface NotFoundException {}

// ä½¿ç”¨ä¾‹
final class ProjectNotFoundException extends DomainException 
    implements ProjectModuleException, NotFoundException {}
```

ã“ã†ã™ã‚‹ã“ã¨ã§ï¼ŒDomain å±¤ã®ç´”ç²‹æ€§ã‚’ä¿ã¡ã¤ã¤ï¼Œé‹ç”¨ä¸Šã¯ HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æŒ¯ã‚Šåˆ†ã‘ãŒæ¥½ã«ãªã‚Šã¾ã™ï¼

### bootstrap/app.php ã§ã®æŒ¯ã‚Šåˆ†ã‘

Laravel 11 ä»¥é™ã§ã¯ `bootstrap/app.php` ã§ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¨­å®šã—ã¾ã™ï¼

```php
->withExceptions(function (Exceptions $exceptions) {
    $exceptions->render(function (DomainException $e, Request $request) {
        if ($e instanceof NotFoundException) {
            return response()->json([
                'error' => 'NOT_FOUND',
                'message' => $e->getMessage(),
            ], 404);
        }
        return response()->json([
            'error' => 'BAD_REQUEST',
            'message' => $e->getMessage(),
        ], 400);
    });

    $exceptions->render(function (TechnicalException $e, Request $request) {
        return response()->json([
            'error' => 'INTERNAL_SERVER_ERROR',
            'message' => 'An unexpected error occurred.',
        ], 500);
    });
})
```

### ãƒ¡ãƒªãƒƒãƒˆ

- **Controller ã‹ã‚‰ try-catch ã‚’å‰Šé™¤**: ä¾‹å¤–ã¯æŠ•ã’ã£ã±ãªã—ã§ OK
- **å‹å®‰å…¨**: `str_contains(get_class($e), 'NotFoundException')` ã‚ˆã‚Šå …ç‰¢
- **é›†ä¸­ç®¡ç†**: ä¸€ç®‡æ‰€ã§ HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’åˆ¶å¾¡
- **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è­˜åˆ¥**: ãƒãƒ¼ã‚«ãƒ¼ Interface ã§ã©ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ã®ä¾‹å¤–ã‹ã‚ã‹ã‚‹

## PHP 8.4 Property Hooks ã‚’æ´»ç”¨ã—ãŸ Readonly Entity

PHP 8.4 ã§å°å…¥ã•ã‚ŒãŸ Property Hooks ã¨ Interface ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å®£è¨€ã‚’ä½¿ã†ã¨ï¼ŒEntity ã®è¨­è¨ˆãŒã‚ˆã‚Šæ´—ç·´ã•ã‚Œã¾ã™ï¼
å€‹äººçš„ã«ã¯ã“ã®æ‰‹æ³•ã¯ã¾ã ã‚ã¾ã‚Šè¨˜äº‹ã§ã‚‚è¦‹ã‹ã‘ãªã„ã®ã§ï¼Œã“ã®æ©Ÿä¼šã«ã—ã£ã‹ã‚Šèª¬æ˜ã—ã¾ã™ï¼

### PHP 8.3 ä»¥å‰ã®è‹¦ã—ã¿

ã“ã‚Œã¾ã§ã€ŒEntity ã« Interface ã‚’æŒãŸã›ãŸã„ã€ã¨æ€ã£ãŸã¨ãï¼Œã“ã†ã™ã‚‹ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼š

```php
// PHP 8.3 ä»¥å‰
interface MemberInterface
{
    public function getId(): string;
    public function getName(): string;
}

class Member implements MemberInterface
{
    public function __construct(
        private readonly string $id,
        private readonly string $name,
    ) {}

    public function getId(): string
    {
        return $this->id;
    }

    public function getName(): string
    {
        return $this->name;
    }
}
```

ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ `private` ã«ã—ã¦ï¼Œã‚ã–ã‚ã– getter ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ï¼ŒInterface ã«ã‚‚ getter ã‚’æ›¸ãï¼
ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã§ç°¡æ½”ã«æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸ PHP 8.1 ä»¥é™ã§ã‚‚ï¼Œã“ã®ã€Œgetter åœ°ç„ã€ã‹ã‚‰ã¯é€ƒã‚Œã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸï¼

ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ 10 å€‹ã‚ã‚Œã° getter ã‚‚ 10 å€‹ï¼ï¼ˆä»Šã¨ãªã£ã¦ã¯ AI ãŒæ›¸ã‘ã°ã„ã„è©±ã§ã¯ã‚ã‚Šã¾ã™ãŒï¼ï¼ï¼ç¬‘ï¼‰

### PHP 8.4 ã§ã®è§£æ”¾

PHP 8.4 ã§ã¯ **Interface ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å®£è¨€ã§ãã‚‹**ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼

```php
// PHP 8.4
interface MemberInterface
{
    public string $id   { get; }
    public string $name { get; }
}

class Member implements MemberInterface
{
    public function __construct(
        public readonly string $id,
        public readonly string $name,
    ) {}
}
```

**ã“ã‚Œã ã‘ã§ã™ï¼**

getter ãƒ¡ã‚½ãƒƒãƒ‰ã¯ä¸è¦ï¼ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã§ `public readonly` ã«ã™ã‚Œã°ï¼ŒInterface ã® `{ get; }` å¥‘ç´„ã‚’è‡ªå‹•çš„ã«æº€ãŸã—ã¾ã™ï¼

ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ 10 å€‹ã‚ã£ã¦ã‚‚ï¼ŒInterface ã« 10 è¡Œï¼ŒClass ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã« 10 è¡Œã§æ¸ˆã¿ã¾ã™ï¼
getter åœ°ç„ã‹ã‚‰å®Œå…¨ã«è§£æ”¾ã•ã‚Œã¾ã—ãŸï¼

### ä½•ãŒå¬‰ã—ã„ã®ã‹

1. **ã‚³ãƒ¼ãƒ‰é‡ãŒæ¿€æ¸›**: getter ãƒ¡ã‚½ãƒƒãƒ‰ãŒä¸è¦ã«ãªã‚Šï¼ŒEntity ãŒã‚¹ãƒƒã‚­ãƒª
2. **èª­ã¿ã‚„ã™ã•å‘ä¸Š**: `$member->name` ã¨æ›¸ã‘ã°ã„ã„ï¼`$member->getName()` ã¯å†—é•·
3. **Contract ã®è¡¨ç¾åŠ›å‘ä¸Š**: ã€Œã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ public ã«èª­ã‚ã‚‹ã€ãŒå‹ãƒ¬ãƒ™ãƒ«ã§è¡¨ç¾ã§ãã‚‹

DDD çš„ãª Entity è¨­è¨ˆã¨ PHP 8.4 ã®æ–°æ©Ÿèƒ½ãŒè¦‹äº‹ã«ãƒãƒƒãƒã—ã¦ã„ã¾ã™ï¼
ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã™ã‚‹ãªã‚‰ï¼Œãœã² PHP 8.4 ã§å§‹ã‚ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ï¼

ã“ã“ã‹ã‚‰ã¯å…·ä½“çš„ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ï¼

### ä½¿ã†è¨€èªæ©Ÿèƒ½

| æ©Ÿèƒ½ | PHP ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | èª¬æ˜ |
|------|---------------|------|
| Readonly ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ | 8.1+ | ä¸€åº¦ã ã‘ä»£å…¥å¯ï¼ä»¥é™ã¯ã‚¨ãƒ©ãƒ¼ |
| Readonly ã‚¯ãƒ©ã‚¹ | 8.2+ | å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ readonly ã«ãªã‚‹ç³–è¡£æ§‹æ–‡ |
| Property Hooks | 8.4+ | ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£èª­ã¿æ›¸ãã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’å·®ã—è¾¼ã‚ã‚‹ |
| Interface ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å®£è¨€ | 8.4+ | Interface ã§ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã® get/set ã®æœ‰ç„¡ã‚’å¥‘ç´„ã§ãã‚‹ |
| éå¯¾ç§°å¯è¦–æ€§ | 8.4+ | èª­ã¿ã¨æ›¸ãã§å¯è¦–æ€§ã‚’åˆ†ã‘ã‚‰ã‚Œã‚‹ï¼ˆ`public private(set)`ï¼‰ |

### Interfaceï¼ˆå¥‘ç´„ï¼‰

Interface ã§ã¯ã€Œpublic ã«èª­ã‚ã‚‹ã€ã“ã¨ã ã‘ã‚’ç´„æŸã—ã¾ã™ï¼

```php
interface MemberInterface
{
    public string $id   { get; }  // å…¬é–‹èª­ã¿å–ã‚Šã®ã¿
    public string $name { get; }
}
```

- `{ get; }` ã§ã€Œpublic ã‹ã‚‰ get ã§ãã‚‹ã€ã ã‘ã‚’ç´„æŸ
- set ã®å¥‘ç´„ã¯èª²ã•ãªã„ï¼ˆå®Ÿè£…å´ãŒæ›¸ãè¾¼ã¿ã‚’è¨±ã™ã‹ã¯è‡ªç”±ï¼‰

### å®Ÿè£…ï¼ˆä¿è¨¼ï¼‰

å®Ÿè£…ã§ã¯ `readonly` ã§ä¸å¤‰ã‚’ä¿è¨¼ã—ã¾ã™ï¼

```php
class Member implements MemberInterface
{
    public function __construct(
        public readonly string $id,
        public readonly string $name,
    ) {}
}
```

:::message
**ãªãœ `readonly class` ã§ã¯ãªã `readonly` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼Ÿ**

ç¾çŠ¶ Mockery ãŒ `readonly class` ã‚’ãƒ¢ãƒƒã‚¯ã§ããªã„ãŸã‚ã§ã™ï¼
ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£ã‚’è€ƒæ…®ã—ã¦ï¼Œãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å˜ä½ã§ `readonly` ã‚’ä»˜ã‘ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ãŒï¼ŒMockery ã§ã¯ãªãéƒ½åº¦ãƒ¢ãƒƒã‚¯ã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã™ã‚‹å½¢ã‚’å–ã‚‹å ´åˆã¯ `readonly class` ã®ã»ã†ãŒè¨˜è¿°é‡ãŒæ¸›ã£ã¦è‰¯ã„ã§ã™ï¼

ã©ã†ã› AI ã«ã‚³ãƒ¼ãƒ‰æ›¸ã‹ã›ã‚‹ãªã‚‰ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…ã« `class MockMember implements MemberInterface` ã‚’ä½œã‚‰ã›ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã­ï¼
ã¨ã„ã†ã‹â€æ­£ã—ã•â€ã§ã„ã†ã¨ Mockery ã‚ˆã‚Š Interface ã®ãƒ¢ãƒƒã‚¯å®Ÿè£…ã®ã»ã†ãŒæ™®é€šã ã¨æ€ã†ã®ã§ï¼ŒAI ã«ã©ã—ã©ã—æ›¸ã‹ã›ã¾ã—ã‚‡ã†ï¼
åå‰è¡çªã ã‘ãŒ PHP ã§ã¯å•é¡Œã«ãªã‚‹ã®ã§ï¼Œé©å½“ã« Prefix ã‚’ã¤ã‘ãŸã‚Šç„¡åã‚¯ãƒ©ã‚¹ã«ã—ãŸã‚Šã—ã¦å·¥å¤«ã—ã¾ã—ã‚‡ã†ï¼
ç„¡åã‚¯ãƒ©ã‚¹ã‚’ä½¿ã†å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã« Test ã‚¯ãƒ©ã‚¹ã« private ãƒ¡ã‚½ãƒƒãƒ‰ã§å®šç¾©ã—ã¦ã‚„ã‚‹ã¨è‰¯ã„ã§ã™ï¼

```php
private function makeMock(): MemberInterface
{
  return new class () implements MemberInterface { ... }
}
```

:::

### ä½¿ç”¨ä¾‹

```php
function greet(MemberInterface $m): void {
    echo "Hi, {$m->name}.\n";
    // $m->id = 'x';  // Interface çš„ã«ã‚‚ set å¥‘ç´„ãªã—ã€å®Ÿä½“ã‚‚ readonly ã§ã‚¨ãƒ©ãƒ¼
}

$m = new Member('m-1', 'smith');
echo $m->id;  // OK
greet($m);

$m->id = 'm-2';  // Fatal: readonly
```

### ã‚ã‚ŠãŒã¡ãª NG ãƒ‘ã‚¿ãƒ¼ãƒ³

```php
interface MemberInterface
{
    // âŒ NG: Interface ã«éå¯¾ç§°å¯è¦–æ€§ã‚’æŒã¡è¾¼ã‚€
    public private(set) string $id { get; }
}
```

`private(set)` ã®ã‚ˆã†ãªæ›¸ãè¾¼ã¿å¯è¦–æ€§ã¯ã‚¯ãƒ©ã‚¹å´ã§ã ã‘æœ‰åŠ¹ã§ã™ï¼
Interface ã«æ›¸ãã¨ Fatal Error ã«ãªã‚Šã¾ã™ï¼

### éå¯¾ç§°å¯è¦–æ€§ã®æ­£ã—ã„ä½¿ã„æ–¹ï¼ˆã‚¯ãƒ©ã‚¹å´ï¼‰

ã‚¯ãƒ©ã‚¹å´ã§ã¯éå¯¾ç§°å¯è¦–æ€§ã‚’ä½¿ãˆã¾ã™ï¼
ã€Œèª­ã¿ã¯ publicï¼Œæ›¸ãã¯ privateã€ã«ã—ãŸã„å ´åˆã«ä¾¿åˆ©ã§ã™ï¼

ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒãŸã›ã‚‹è¨­è¨ˆã§ã¯ï¼ŒEntity ãŒè‡ªèº«ã®çŠ¶æ…‹ã‚’å¤‰æ›´ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒã¤ã“ã¨ãŒå¤šã„ã§ã™ã‚ˆã­ï¼
ãã†ã„ã†ã¨ãã«éå¯¾ç§°å¯è¦–æ€§ãŒæ´»ãã¾ã™ï¼

```php
interface ProjectInterface
{
    public ProjectId $id       { get; }
    public string $name        { get; }
    public ProjectStatus $status { get; }
}

class Project implements ProjectInterface
{
    public function __construct(
        public readonly ProjectId $id,
        public private(set) string $name { get; },
        public private(set) ProjectStatus $status { get; },
    ) {}

    public function rename(string $newName): void
    {
        $this->name = $newName;  // ã‚¯ãƒ©ã‚¹å†…éƒ¨ã§ã¯æ›¸ãè¾¼ã¿å¯èƒ½
    }

    public function activate(): void
    {
        $this->status = ProjectStatus::Active;
    }

    public function archive(): void
    {
        $this->status = ProjectStatus::Archived;
    }
}
```

- `id` ã¯ä¸€åº¦æ±ºã¾ã£ãŸã‚‰å¤‰ã‚ã‚‰ãªã„ã®ã§ `readonly`
- `name` ã¨ `status` ã¯æŒ¯ã‚‹èˆã„ã‚’é€šã˜ã¦å¤‰æ›´ã•ã‚Œã†ã‚‹ã®ã§ `private(set)`

`readonly` ã ã¨ `rename()` ã‚„ `activate()` ã®ã‚ˆã†ãªãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ãŒæ›¸ã‘ã¾ã›ã‚“ãŒï¼Œéå¯¾ç§°å¯è¦–æ€§ãªã‚‰å†…éƒ¨ã§ã®å¤‰æ›´ã¯è¨±å¯ã—ã¤ã¤å¤–éƒ¨ã‹ã‚‰ã®ç›´æ¥å¤‰æ›´ã¯ç¦æ­¢ã§ãã¾ã™ï¼

```php
$project->rename('æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå');  // OK: ãƒ¡ã‚½ãƒƒãƒ‰çµŒç”±
$project->name = 'ç›´æ¥å¤‰æ›´';              // NG: private(set) ãªã®ã§ã‚¨ãƒ©ãƒ¼
```

ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«ã«æŒ¯ã‚‹èˆã„ã‚’æŒãŸã›ãŸã„è¨­è¨ˆã¨ç›¸æ€§æŠœç¾¤ã§ã™ï¼

### Property Hooks ã§æ­£è¦åŒ–ãƒ»æ´¾ç”Ÿå€¤

å…¥åŠ›æ™‚ã®æ­£è¦åŒ–ã‚„æ´¾ç”Ÿå€¤ã®è¨ˆç®—ã« Property Hooks ã‚’ä½¿ãˆã¾ã™ï¼

```php
class Member implements MemberInterface
{
    public readonly string $id;

    public string $name {
        get { return $this->name; }
        set(string $value) { $this->name = trim($value); }  // æ­£è¦åŒ–
    }

    // æ´¾ç”Ÿå€¤
    public string $displayName {
        get { return strtoupper($this->name); }
    }

    public function __construct(string $id, string $name)
    {
        $this->id = $id;
        $this->name = $name;  // set hook çµŒç”±ã§æ­£è¦åŒ–
    }
}
```

:::message
ä¸Šè¨˜ã® `trim` ã®ã‚ˆã†ãªæ­£è¦åŒ–ã¯ï¼Œæœ¬æ¥ã§ã‚ã‚Œã° `new` ã™ã‚‹å‰ï¼ˆAssembler ã‚„ Factoryï¼‰ã§è¡Œã‚ã‚Œã¦ã„ã‚‹ã¹ãã§ã™ï¼
Property Hooks ã§ã®æ­£è¦åŒ–ã¯ä½¿ã„æ‰€ã‚’é¸ã³ã¾ã™ï¼æ´¾ç”Ÿå€¤ï¼ˆ`displayName` ã®ã‚ˆã†ãªè¨ˆç®—ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ã®ã»ã†ãŒå®Ÿç”¨çš„ãªä½¿ã„é“ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼ï¼ˆdisplayName ã‚‚ã¶ã£ã¡ã‚ƒã‘ View ã®è©±ãªã®ã§ Entity ã«ç½®ãã¹ãã‚‚ã®ã§ã¯ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼æœ¬å½“ã«ä½¿ã„æ‰€ã‚’é¸ã³ã¾ã™ã­ï¼ï¼‰

ãã‚‚ãã‚‚ï¼ŒEntity ã®å†…éƒ¨çŠ¶æ…‹ã®å¤‰åŒ–ã¯å¯èƒ½ãªé™ã‚Šé¿ã‘ãŸã„ã¨ã“ã‚ã§ã™ï¼
`readonly` ã‚’åŸºæœ¬ã¨ã—ï¼Œã©ã†ã—ã¦ã‚‚ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã¨ã—ã¦çŠ¶æ…‹å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã ã‘ `private(set)` ã‚’ä½¿ã†ï¼Œã¨ã„ã†æ–¹é‡ãŒãŠã™ã™ã‚ã§ã™ï¼
:::

### è¨­è¨ˆåŸå‰‡ã¾ã¨ã‚

| åŸå‰‡ | å†…å®¹ |
|------|------|
| **å¥‘ç´„ã¯æœ€å°** | Interface ã¯ `{ get; }` ã®ã¿ã§ååˆ†ï¼setter ã‚’å¥‘ç´„ã«å«ã‚ãªã„ |
| **ä¿è¨¼ã¯å®Ÿè£…å¼·ã‚** | `readonly` ã‚’ç©æ¥µåˆ©ç”¨ |
| **æŒ¯ã‚‹èˆã„ã¯ Hook** | æ­£è¦åŒ–ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»æ´¾ç”Ÿå€¤ã¯ Property Hooks ã«å¯„ã›ã‚‹ |
| **å¯è¦–æ€§ã¯ã‚¯ãƒ©ã‚¹ã§èª¿æ•´** | å¤–éƒ¨æ›¸ãè¾¼ã¿åˆ¶é™ãŒå¿…è¦ãªã‚‰éå¯¾ç§°å¯è¦–æ€§ã‚’ã‚¯ãƒ©ã‚¹å´ã§ |

# ãŠã‚ã‚Šã«

æ°—ã¥ã„ãŸã‚‰ã‚‚ã®ã™ã”ã„ãƒœãƒªãƒ¥ãƒ¼ãƒ ã«ãªã£ã¦ã„ã¾ã—ãŸãŒï¼Œï¼•å¹´é–“ Laravel ã‚’ä½¿ã„ãªãŒã‚‰è‰²ã€…è©¦è¡ŒéŒ¯èª¤ã—ã¦ããŸè¨­è¨ˆã‚’ã‚„ã£ã¨è¨€èªåŒ–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸï¼

å®Ÿè·µçš„ãªè©±ã§è¨€ãˆã°ï¼Œã‚‚ã†å°‘ã—ãƒã‚¿ã¯ã‚ã‚‹ã®ã§ï¼Œä½™è£•ãŒã‚ã‚Œã° Zenn ã® Books ã«ã§ã‚‚ã—ã¦ã¿ã‚ˆã†ã‹ã¨æ€ã„ã¾ã™ï¼

è¨­è¨ˆã«æ­£è§£ã¯ãªã„ã¨æ€ã£ã¦ã„ã‚‹ã®ã§ï¼Œã“ã®è¨˜äº‹ã«ã‚‚ãŸãã•ã‚“ãƒã‚µã‚«ãƒªãŒä»˜ãã¨æ€ã„ã¾ã™ãŒï¼Œãã‚Œã‚‚å«ã‚ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®è³‡ç”£ã ã¨æ€ã†ã®ã§ï¼Œè‰¯ã„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚‚æ‚ªã„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚‚ãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼

ãŸã ï¼Œã€Œã“ã“ã¾ã§ã™ã‚‹ãªã‚‰ Laravel ã‚„ã‚ã‚ã‚ˆã€ã ã‘ã¯è¨€ã‚ãªã„ã§ï¼Laravel ãŒå¥½ããªã ã‘ãªã®ï¼

ã‚ã¨ï¼Œ @mpyw å¸«åŒ ï¼Œã“ã‚Œã‹ã‚‰ã‚‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼
